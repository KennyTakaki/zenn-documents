---
title: "ã¯ã˜ã‚ã¦ã®ãƒ¢ãƒŽãƒ¬ãƒæ§‹ç¯‰è¨˜éŒ² â€“ pnpm Ã— Turborepo Ã— AWS ã§å°‘ã—ãšã¤æ•´ãˆã¦ã¿ãŸ"
emoji: "ðŸ’¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AWS","Monorepo","Turborepo","zennfes2025free"]
published: false
---

# **ã¯ã˜ã‚ã«**
## æœ¬è¨˜äº‹ã®ç›®çš„
æœ¬è¨˜äº‹ã§ã¯ã€ç§ãŒã“ã‚Œã¾ã§ã«æ§‹ç¯‰ã—ã¦ããŸãƒ¢ãƒŽãƒ¬ãƒç’°å¢ƒã®ä»•æ§˜ã¨è¨­è¨ˆã«ã¤ã„ã¦æ•´ç†ã—ã€æŠ€è¡“çš„ãªèƒŒæ™¯ã‚„æŽ¡ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«ç¾¤ã‚’ä½“ç³»çš„ã«ã¾ã¨ã‚ã¾ã™ã€‚  
ã“ã®ç’°å¢ƒã¯ã€è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åŠ¹çŽ‡çš„ã«ç®¡ç†ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€CI/CDãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ã‚³ãƒ¼ãƒ‰å“è³ªãƒ»é–‹ç™ºä½“é¨“ï¼ˆDXï¼‰ã¾ã§ã‚’å«ã‚ãŸçµ±åˆçš„ãªé–‹ç™ºåŸºç›¤ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚  

å˜ãªã‚‹å‚™å¿˜éŒ²ã«ç•™ã‚ãšã€åŒã˜ã‚ˆã†ã«ãƒ¢ãƒŽãƒ¬ãƒã‚’å°Žå…¥ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚„ãƒãƒ¼ãƒ ã«ã¨ã£ã¦ã€å‚è€ƒã«ãªã‚‹å®Ÿè·µçš„ãªçŸ¥è¦‹ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã‚’ç‹™ã„ã¨ã—ã¦ã„ã¾ã™ã€‚

## å¯¾è±¡èª­è€…
- ãƒ¢ãƒŽãƒ¬ãƒç’°å¢ƒã®å°Žå…¥ã‚’æ¤œè¨Žã—ã¦ã„ã‚‹å€‹äººé–‹ç™ºè€…ã‚„å°è¦æ¨¡ãƒãƒ¼ãƒ   
- AWSãƒ»GitHub Actionsãƒ»pnpmãƒ»Turborepo ã¨ã„ã£ãŸãƒ¢ãƒ€ãƒ³ãªé–‹ç™ºã‚¹ã‚¿ãƒƒã‚¯ã«é–¢å¿ƒã®ã‚ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢  
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚„ CI/CD ã‚’çµ„ã¿è¾¼ã‚“ã çµ±åˆçš„ãªé–‹ç™ºåŸºç›¤ã‚’è¨­è¨ˆã—ãŸã„äºº  
- DevContainer ã‚„ VS Code ã‚’æ´»ç”¨ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã¨ CI ç’°å¢ƒã‚’çµ±ä¸€ã—ãŸã„äºº  

## ãƒ¢ãƒŽãƒ¬ãƒã‚’æŽ¡ç”¨ã—ãŸèƒŒæ™¯
å¾“æ¥ã®è¤‡æ•°ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†ã§ã¯ä»¥ä¸‹ã®èª²é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚  

- å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã”ã¨ã«ä¾å­˜é–¢ä¿‚ã‚„ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã‚’å€‹åˆ¥ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹  
- å…±é€šã‚³ãƒ¼ãƒ‰ã‚„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å†åˆ©ç”¨ãŒç…©é›‘ã«ãªã‚Šã€æ›´æ–°ã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒåˆ†æ•£ã—ã¦ã—ã¾ã†  
- CI/CD ã®è¨­å®šãŒãƒªãƒã‚¸ãƒˆãƒªã”ã¨ã«åˆ†æ•£ã—ã€é‹ç”¨ã‚³ã‚¹ãƒˆãŒé«˜ããªã‚‹  

ã“ã‚Œã‚‰ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ãƒ¢ãƒŽãƒ¬ãƒã‚’æŽ¡ç”¨ã—ã¾ã—ãŸã€‚  
ãƒ¢ãƒŽãƒ¬ãƒåŒ–ã™ã‚‹ã“ã¨ã§ä»¥ä¸‹ã®åˆ©ç‚¹ã‚’å¾—ã¦ã„ã¾ã™ã€‚  

- **ä¾å­˜é–¢ä¿‚ã®ä¸€å…ƒç®¡ç†**ï¼špnpm workspace ã«ã‚ˆã£ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ã‚¢ãƒ—ãƒªé–“ã®ä¾å­˜ã‚’åŠ¹çŽ‡çš„ã«è§£æ±º  
- **ãƒ“ãƒ«ãƒ‰ãƒ»ã‚¿ã‚¹ã‚¯ã®é«˜é€ŸåŒ–**ï¼šTurborepo ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ä¸¦åˆ—å®Ÿè¡Œã§é–‹ç™ºåŠ¹çŽ‡ã‚’å‘ä¸Š  
- **çµ±åˆçš„ãªCI/CD**ï¼šGitHub Actions ã‚’ä¸­å¿ƒã«ã€dev / prod ç’°å¢ƒã«å¿œã˜ãŸãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–  
- **ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ‹…ä¿**ï¼šESLint, Prettier, Husky, Gitleaks ãªã©ã«ã‚ˆã‚‹é–‹ç™ºæ®µéšŽã§ã®å“è³ªãƒã‚§ãƒƒã‚¯  
- **çµ±ä¸€ã•ã‚ŒãŸé–‹ç™ºä½“é¨“**ï¼šDevContainer ã¨ VS Code ã«ã‚ˆã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«ã¨CIç’°å¢ƒã‚’ä¸€è‡´ã•ã›å†ç¾æ€§ã‚’ç¢ºä¿  

ã“ã‚Œã‚‰ã®èƒŒæ™¯ã‚’è¸ã¾ãˆã€æœ¬è¨˜äº‹ã§ã¯ã€Œä»•æ§˜ã€ã¨ã€Œè¨­è¨ˆã€ã¨ã„ã†2ã¤ã®è¦³ç‚¹ã‹ã‚‰ãƒ¢ãƒŽãƒ¬ãƒç’°å¢ƒã‚’æ•´ç†ã—ã¦ã„ãã¾ã™ã€‚

# **ãƒ¢ãƒŽãƒ¬ãƒã®å…¨ä½“ä»•æ§˜**
## ç®¡ç†ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹æˆ
æœ€åˆã¯ã€Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä¸€ç·’ã«ç®¡ç†ã—ãŸã„ã€ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªå‹•æ©Ÿã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚  
å€‹åˆ¥ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¦ã„ãŸã¨ãã¯ã€ã¡ã‚‡ã£ã¨ã—ãŸå¤‰æ›´ã§ã‚‚è¤‡æ•°ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’è¡Œãæ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€åŠ¹çŽ‡ãŒæ‚ªã„ã¨æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚  

ãã“ã§ã€ãƒ¢ãƒŽãƒ¬ãƒã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã‚’æŽ¡ç”¨ã—ã¾ã—ãŸã€‚  

- `apps/` : å®Ÿéš›ã«å‹•ä½œã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é…ç½®  
  - ä¾‹: Web ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰, API ã‚µãƒ¼ãƒãƒ¼  
- `packages/` : è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰åˆ©ç”¨ã™ã‚‹å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é…ç½®  
  - ä¾‹: infraï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å®šç¾©ï¼‰, uiï¼ˆå…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰, utilsï¼ˆå…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼‰  

ã“ã®ã€Œappsã€ã¨ã€Œpackagesã€ã®2éšŽå±¤ã§æ•´ç†ã™ã‚‹ã“ã¨ã§ã€æœ€åˆã‹ã‚‰éŽåº¦ã«è¤‡é›‘ã«ã›ãšã€å¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µã—ã¦ã„ã‘ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

---

## ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®åŸºæœ¬æ–¹é‡
ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†ã«ã¯ **pnpm workspace** ã‚’æŽ¡ç”¨ã—ã¾ã—ãŸã€‚  

ç†ç”±ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚  
- node_modules ã‚’è³¢ãå…±æœ‰ã—ã¦ãã‚Œã‚‹ãŸã‚ã€ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚é–“ã‚’ç¯€ç´„ã§ãã‚‹  
- ã‚¢ãƒ—ãƒªã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–“ã®ä¾å­˜é–¢ä¿‚ã‚’ `pnpm-workspace.yaml` ã§ã‚·ãƒ³ãƒ—ãƒ«ã«å®šç¾©ã§ãã‚‹  
- æœ€åˆã®å°ã•ãªæ§‹æˆã‹ã‚‰å¤§è¦æ¨¡ãªæ‹¡å¼µã¾ã§å¯¾å¿œã§ãã‚‹æŸ”è»Ÿæ€§ãŒã‚ã‚‹  

ã€Œã¾ãšã¯å‹•ãã‚‚ã®ã‚’ä½œã‚ŠãŸã„ã€ã¨ã„ã†æ°—æŒã¡ã§é¸ã³ã¾ã—ãŸãŒã€çµæžœçš„ã«å¾Œã‹ã‚‰è¿½åŠ ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ã‚¢ãƒ—ãƒªã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«çµ±åˆã§ãã¦ã„ã¾ã™ã€‚

---

## é–‹ç™ºç’°å¢ƒã®å‰ææ¡ä»¶
é–‹ç™ºç’°å¢ƒã‚’æƒãˆã‚‹ã®ã¯ã€é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã§ã—ãŸã€‚  

- **ã‚¨ãƒ‡ã‚£ã‚¿**ã¯ VS Code ã‚’æŽ¡ç”¨ã—ã€å…¨å“¡ãŒåŒã˜é–‹ç™ºä½“é¨“ã‚’å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸ  
- **DevContainer** ã‚’ç”¨æ„ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒãŒã©ã“ã§ã‚‚å†ç¾ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸ  
- Node.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ AWS CLI ãªã©ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã‚‚ã‚³ãƒ³ãƒ†ãƒŠã§çµ±ä¸€ã—ã€ç’°å¢ƒä¾å­˜ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚’æ¸›ã‚‰ã—ã¾ã—ãŸ  

ã“ã®ãŠã‹ã’ã§ã€Œç’°å¢ƒæ§‹ç¯‰ã§ã¤ã¾ãšãã€ã“ã¨ãŒã»ã¼ãªããªã‚Šã€é–‹ç™ºã«å…¥ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚  

---

## æŒ¯ã‚Šè¿”ã‚Š
ã“ã†ã—ã¦å…¨ä½“ä»•æ§˜ã‚’æ•´ç†ã™ã‚‹ã¨ã€å½“åˆã¯ã€Œã¨ã«ã‹ãä¸€ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¾ã¨ã‚ã‚‹ã€ã“ã¨ã‹ã‚‰å§‹ã‚ãŸã®ã§ã™ãŒã€çµæžœçš„ã«  
- **apps ã¨ packages ã®å½¹å‰²åˆ†æ‹…**  
- **pnpm workspace ã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚ç®¡ç†**  
- **DevContainer ã«ã‚ˆã‚‹å†ç¾æ€§ã®é«˜ã„é–‹ç™ºç’°å¢ƒ**  

ã¨ã„ã£ãŸè¦ç´ ãŒè‡ªç„¶ã¨æƒã£ã¦ã„ãã¾ã—ãŸã€‚  

å¤§ããªè¨­è¨ˆã‚’ã„ããªã‚Šç›®æŒ‡ã™ã‚ˆã‚Šã‚‚ã€**ã€Œå°ã•ãå§‹ã‚ã¦å¾Œã‹ã‚‰æ‹¡å¼µã™ã‚‹ã€** ã¨ã„ã†æµã‚ŒãŒè‡ªåˆ†ã«ã¯åˆã£ã¦ã„ãŸã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

# ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ç¾¤ã®ä¸€è¦§

ãƒ¢ãƒŽãƒ¬ãƒã‚’æ§‹ç¯‰ã™ã‚‹ã«ã‚ãŸã‚Šã€ã•ã¾ã–ã¾ãªãƒ„ãƒ¼ãƒ«ã‚’è©¦ã—ã¾ã—ãŸã€‚  
æœ€åˆã‹ã‚‰ã™ã¹ã¦ã‚’æƒãˆã¦ã„ãŸã‚ã‘ã§ã¯ãªãã€ã€Œã“ã‚ŒãŒå¿…è¦ã‹ã‚‚ã€ã¨æ€ã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¿½åŠ ã—ã¦ã„ãã¾ã—ãŸã€‚  
ã“ã“ã§ã¯ç¾åœ¨åˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ç¾¤ã¨ã€ãã‚Œãžã‚Œã‚’å°Žå…¥ã—ãŸç†ç”±ãƒ»å½¹å‰²ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

---

## é–‹ç™ºç’°å¢ƒ
- **VS Code**  
  ã‚¨ãƒ‡ã‚£ã‚¿ã¯ VS Code ã‚’æ¨™æº–ã¨ã—ã¾ã—ãŸã€‚æ‹¡å¼µæ©Ÿèƒ½ãŒè±Šå¯Œã§ã€TypeScript ã‚„ AWS é–‹ç™ºã¨ã®ç›¸æ€§ã‚‚è‰¯ã„ãŸã‚ã§ã™ã€‚  
- **DevContainer**  
  é–‹ç™ºç’°å¢ƒã‚’ãƒãƒ¼ãƒ ã‚„ CI ã¨æƒãˆã‚‹ãŸã‚ã«å°Žå…¥ã—ã¾ã—ãŸã€‚Node.js ã‚„ AWS CLI ãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã¾ã¨ã‚ã€ç’°å¢ƒå·®ç•°ã«ã‚ˆã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã‚’é¿ã‘ã¦ã„ã¾ã™ã€‚  

---

## ç”ŸæˆAI
- **Amazon Q Developer CLI**  
  é–‹ç™ºä¸­ã®è©¦è¡ŒéŒ¯èª¤ã‚’è£œåŠ©ã™ã‚‹ãŸã‚ã«æ´»ç”¨ã—ã¦ã„ã¾ã™ã€‚ã‚¿ã‚¹ã‚¯ã‚„ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ãªãŒã‚‰ã€ãƒ¢ãƒŽãƒ¬ãƒã®æ•´å‚™ã‚’é€²ã‚ã‚„ã™ãã—ã¦ã„ã¾ã™ã€‚  

- **Chat GPT Plus**
  ã‚»ã‚«ãƒ³ãƒ‰ã‚ªãƒ”ãƒ‹ã‚ªãƒ³çš„ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ãªãã€æ–¹é‡ãªã©ã‚’å£æ‰“ã¡ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã—ã¾ã—ãŸã€‚ã‚¹ãƒžãƒ›ã‚¢ãƒ—ãƒªã§ç§»å‹•ä¸­ãªã©ã«é ­ã®æ•´ç†ã‚’ã§ãã‚‹ã®ãŒæœ€å¤§ã®åˆ©ç‚¹ã ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

---

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†
- **pnpm**  
  workspace æ©Ÿèƒ½ãŒå¼·åŠ›ã§ã€ãƒ¢ãƒŽãƒ¬ãƒã¨ã®ç›¸æ€§ãŒéžå¸¸ã«è‰¯ã„ã§ã™ã€‚  
  npm ã‚„ yarn ã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é€Ÿåº¦ãŒé€Ÿãã€ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚‚ç¯€ç´„ã§ãã¾ã™ã€‚  

---

## ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼
- **Turborepo**  
  ãƒ¢ãƒŽãƒ¬ãƒå†…ã®ã‚¿ã‚¹ã‚¯ã‚’åŠ¹çŽ‡çš„ã«ç®¡ç†ã™ã‚‹ãŸã‚ã«å°Žå…¥ã—ã¾ã—ãŸã€‚  
  ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®ãŠã‹ã’ã§ã€å¤‰æ›´ãŒãªã„éƒ¨åˆ†ã®ãƒ“ãƒ«ãƒ‰ã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ãã€é–‹ç™ºåŠ¹çŽ‡ãŒå¤§å¹…ã«æ”¹å–„ã—ã¾ã—ãŸã€‚  

---

## ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†
- **AWS CDK**  
  ç¾çŠ¶ã¯ã¾ã  S3 ãƒã‚±ãƒƒãƒˆã®æ§‹ç¯‰ã«ã¨ã©ã¾ã£ã¦ã„ã¾ã™ãŒã€å°†æ¥çš„ã« IaC (Infrastructure as Code) ã‚’æœ¬æ ¼å°Žå…¥ã™ã‚‹ãŸã‚ã«é¸æŠžã—ã¾ã—ãŸã€‚  
  TypeScript ã§æ›¸ã‘ã‚‹ãŸã‚ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚„ API ã¨åŒã˜è¨€èªžã§çµ±ä¸€ã§ãã‚‹ç‚¹ã‚‚é­…åŠ›ã§ã™ã€‚  

---

## CI/CD
- **GitHub Actions**  
  ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ–ãƒ©ãƒ³ãƒã¸ã® push ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã€Lint ã‚„ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã—ã¦ã„ã¾ã™ã€‚  
  OIDC ã‚’ä½¿ã£ãŸ AWS èªè¨¼ã‚’çµ„ã¿è¾¼ã¿ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¾ã—ãŸã€‚  

---

## ã‚³ãƒ¼ãƒ‰å“è³ª
- **ESLint**  
  TypeScript/JavaScript ã®é™çš„è§£æžã‚’è¡Œã„ã€ãƒã‚°ã‚’é˜²ãŽã¾ã™ã€‚  
- **Prettier**  
  ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’çµ±ä¸€ã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç„¡é§„ãªå·®åˆ†ã‚’æ¸›ã‚‰ã—ã¾ã—ãŸã€‚  
- **Markdownlint**  
  ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆREADME ã‚„ãƒ–ãƒ­ã‚°è¨˜äº‹ï¼‰ã®æ•´å½¢ãƒ«ãƒ¼ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ãŸã‚ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚  

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **Gitleaks**  
  èª¤ã£ã¦ API Key ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã‚ˆã†ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¹ã‚­ãƒ£ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚  
  Husky ã® pre-commit ãƒ•ãƒƒã‚¯ã¨é€£æºã—ã¦ã€è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  

---

## ãƒ†ã‚¹ãƒˆ
- **Jest**  
  åŸºæœ¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦æŽ¡ç”¨ã—ã¾ã—ãŸã€‚  
- **Vitest**  
  ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®ãƒ†ã‚¹ãƒˆã§ã¯ Jest ã‚ˆã‚Šè»½é‡ãª Vitest ã‚‚è©¦ã—ã¦ã„ã¾ã™ã€‚  
- **React Testing Library**  
  React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æŒ™å‹•ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ç›®ç·šã§æ¤œè¨¼ã™ã‚‹ãŸã‚ã«å°Žå…¥ã—ã¾ã—ãŸã€‚  

---

## Git Hooks
- **Husky**  
  Git ãƒ•ãƒƒã‚¯ã‚’ç°¡å˜ã«è¨­å®šã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚  
  `pre-commit` ã§ Lint ã‚„ Gitleaks ã‚’å®Ÿè¡Œã—ã€å•é¡ŒãŒã‚ã‚Œã°ã‚³ãƒŸãƒƒãƒˆã§ããªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚  

---

## æŒ¯ã‚Šè¿”ã‚Š
ã“ã†ã—ã¦è¦‹ã‚‹ã¨ã€ãƒ¢ãƒŽãƒ¬ãƒã®ä»•æ§˜ã‚’æ”¯ãˆã¦ã„ã‚‹ã®ã¯ã€Œä¸€åº¦ã«å°Žå…¥ã—ãŸãƒ„ãƒ¼ãƒ«ã€ã§ã¯ãªãã€å¿…è¦ã«å¿œã˜ã¦å°‘ã—ãšã¤è¿½åŠ ã—ã¦ããŸã‚‚ã®ã°ã‹ã‚Šã§ã™ã€‚  
æœ€åˆã¯ **pnpm + Turborepo** ã®æœ€ä½Žé™ã®ã‚»ãƒƒãƒˆã‹ã‚‰å§‹ã‚ã€å¾Œã‹ã‚‰ **ESLint, Prettier, Husky, Gitleaks** ã‚’è¶³ã—ã¦ã„ãã¾ã—ãŸã€‚  

åˆå¿ƒè€…ã¨ã—ã¦ã¯ã€Œã„ããªã‚Šå®Œç’§ãªã‚¹ã‚¿ãƒƒã‚¯ã‚’çµ„ã‚€ã€ã®ã¯é›£ã—ã„ã§ã™ãŒã€æ®µéšŽçš„ã«å°Žå…¥ã—ã¦ã„ãã“ã¨ã§çµæžœçš„ã«ä»Šã®ã‚ˆã†ãªæ§‹æˆã«è‚²ã¡ã¾ã—ãŸã€‚

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­è¨ˆ

## apps/ ã¨ packages/ ã®å½¹å‰²
ãƒ¢ãƒŽãƒ¬ãƒã‚’å§‹ã‚ãŸã¨ãã«ä¸€ç•ªè¿·ã£ãŸã®ãŒã€Œã©ã®ã‚ˆã†ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã‚‹ã‹ã€ã§ã—ãŸã€‚  
æœ€åˆã¯å…¨éƒ¨ã‚’ä¸€ã¤ã®ãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã‚Œã¦ã„ã¾ã—ãŸãŒã€ã ã‚“ã ã‚“ç®¡ç†ãŒå¤§å¤‰ã«ãªã£ã¦ããŸã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«è½ã¡ç€ãã¾ã—ãŸã€‚

- **apps/**  
  å®Ÿéš›ã«å‹•ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç½®ãå ´æ‰€ã§ã™ã€‚  
  ä¾‹:  
  - `web/` (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰SPA)  
  - `api/` (APIã‚µãƒ¼ãƒãƒ¼)  

- **packages/**  
  è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã§ä½¿ã†å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç½®ãå ´æ‰€ã§ã™ã€‚  
  ä¾‹:  
  - `infra/` (CDKã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©å®šç¾©)  
  - `ui/` (å…±é€šReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)  
  - `utils/` (å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°)  

ã“ã®åˆ†ã‘æ–¹ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€**ã€Œã‚¢ãƒ—ãƒªã€ã¨ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã‚’ç‰©ç†çš„ã«åˆ†ã‘ã‚‹ã€**ã“ã¨ã§é ­ã®æ•´ç†ãŒã¤ãã‚„ã™ããªã‚Šã¾ã—ãŸã€‚  

---

## pnpm-workspace.yaml ã®å®šç¾©
pnpm ã§ã¯ `pnpm-workspace.yaml` ã‚’ä½¿ã£ã¦ã€ã©ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«å«ã‚ã‚‹ã‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚  
ç§ã®è¨­å®šã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```yaml
packages:
  - "apps/*"
  - "packages/*"
```

ã“ã†ã™ã‚‹ã“ã¨ã§ã€apps/ ã¨ packages/ é…ä¸‹ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè‡ªå‹•çš„ã«ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦èªè­˜ã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã£ã¦ã€ä¾‹ãˆã° apps/web ãŒ packages/ui ã«ä¾å­˜ã™ã‚‹å ´åˆã§ã‚‚ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã«ã¯ç›´æŽ¥ãƒªãƒ³ã‚¯ã•ã‚Œã‚‹ã®ã§ã€å¤‰æ›´ãŒã™ãåæ˜ ã•ã‚Œã‚‹ã®ãŒä¾¿åˆ©ã§ã™ã€‚


## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ä¾å­˜é–¢ä¿‚ã®æ–¹é‡

åˆå¿ƒè€…ã®ã†ã¡ã¯ã€Œä¾å­˜é–¢ä¿‚ãŒãã¡ã‚ƒãã¡ã‚ƒã«ãªã‚‹ã®ã§ã¯ï¼Ÿã€ã¨ã„ã†ä¸å®‰ãŒã‚ã‚Šã¾ã—ãŸã€‚
ãã“ã§ã€è‡ªåˆ†ãªã‚Šã«ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’ç½®ãã¾ã—ãŸã€‚
apps â†’ packages ã¸ã®ä¾å­˜ã¯OK
ã‚¢ãƒ—ãƒªã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†æƒ³å®šãªã®ã§ä¾å­˜ã—ã¦ã‚ˆã„
packages â†’ apps ã¸ã®ä¾å­˜ã¯NG

å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¢ãƒ—ãƒªã«ä¾å­˜ã™ã‚‹ã¨å¾ªç’°å‚ç…§ã«ãªã‚Šã‚„ã™ã„ãŸã‚ç¦æ­¢
packages åŒå£«ã®ä¾å­˜ã¯æœ€å°é™ã«
ã©ã†ã—ã¦ã‚‚å¿…è¦ãªå ´åˆã ã‘ä¾å­˜ã™ã‚‹ï¼ˆutils ãªã©æ±Žç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä¾‹å¤–ï¼‰
ã“ã†ã—ãŸãƒ«ãƒ¼ãƒ«ã‚’æ±ºã‚ãŸã“ã¨ã§ã€ä¾å­˜é–¢ä¿‚ãŒè¤‡é›‘ã«ãªã‚Šã™ãŽãšã€ç®¡ç†ãŒã—ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚


## æŒ¯ã‚Šè¿”ã‚Š

æœ€åˆã¯ã€Œãƒ¢ãƒŽãƒ¬ãƒã£ã¦é›£ã—ãã†ã€ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€å®Ÿéš›ã«ã‚„ã£ã¦ã¿ã‚‹ã¨apps ã¨ packages ã‚’åˆ†ã‘ã‚‹ã ã‘ã§ã‚‚é ­ãŒæ•´ç†ã§ãã‚‹ã€pnpm-workspace.yaml ã‚’æ›¸ãã ã‘ã§ä¾å­˜ç®¡ç†ãŒæ¥½ã«ãªã‚‹ã€ã¨ã€æ„å¤–ã¨ã‚·ãƒ³ãƒ—ãƒ«ã«å§‹ã‚ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
ã“ã®ã‚ãŸã‚Šã‹ã‚‰ã€Œãƒ¢ãƒŽãƒ¬ãƒã£ã¦å®Ÿã¯åˆå¿ƒè€…ã«ã‚‚å„ªã—ã„ã®ã§ã¯ï¼Ÿã€ã¨æ„Ÿã˜å§‹ã‚ã¾ã—ãŸã€‚



# ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­è¨ˆ

ãƒ¢ãƒŽãƒ¬ãƒã‚’å°Žå…¥ã—ãŸã¨ãã«æ¬¡ã«æ‚©ã‚“ã ã®ãŒã€**ã€Œè¤‡æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã‚„ãƒ†ã‚¹ãƒˆã‚’ã©ã†åŠ¹çŽ‡ã‚ˆãå›žã™ã‹ã€**ã§ã—ãŸã€‚  
å˜ç´”ã« `pnpm -r build` ã®ã‚ˆã†ã«å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ¯Žå›žå®Ÿè¡Œã™ã‚‹ã¨ã€å¤‰æ›´ãŒãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã—ã¾ã„ã€æ™‚é–“ãŒç„¡é§„ã«ãªã‚Šã¾ã™ã€‚  

ãã“ã§å°Žå…¥ã—ãŸã®ãŒ **Turborepo** ã§ã™ã€‚  
Turborepo ã®ä¾¿åˆ©ãªç‚¹ã®ã²ã¨ã¤ã«ã€**Git ã®ãƒ’ã‚¹ãƒˆãƒªã‚’ä½¿ã£ã¦å·®åˆ†ã‚’æ¤œå‡ºã—ã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã ã‘ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«ã™ã‚‹**ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã™ã€‚  

é€šå¸¸ã€`pnpm run build` ã®ã‚ˆã†ã«å…¨ä½“ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€å¤‰æ›´ãŒãªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¾ã§æ¯Žå›žå‡¦ç†ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã—ã‹ã— Turborepo ã¯ Git ã®ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’å‚ç…§ã—ã€ã€Œä»Šå›žã®å¤‰æ›´ã§å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã‚’ç‰¹å®šã—ã¾ã™ã€‚  

ã¾ãŸã€ãƒ“ãƒ«ãƒ‰ã—ãŸçµæžœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã€ä¾å­˜è§£æ±ºã®ä»•çµ„ã¿ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€å®Ÿéš›ã®é–‹ç™ºåŠ¹çŽ‡ãŒå¤‰ã‚ã‚‹ã“ã¨ãŒæœŸå¾…ã§ãã¾ã™ã€‚

---

## Turborepo ã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯å®šç¾©

Turborepo ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã« `turbo.json` ã‚’é…ç½®ã—ã¦ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã—ã¾ã™ã€‚  
ç§ã®æœ€åˆã®è¨­å®šã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã—ãŸã€‚

```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**", "build/**"]
    },
    "lint": {
      "outputs": []
    },
    "test": {
      "dependsOn": ["^build"],
      "outputs": []
    },
    "dev": {
      "cache": false
    }
  }
}
```
ã“ã“ã§ã®ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚

- build ã‚¿ã‚¹ã‚¯
è‡ªåˆ†è‡ªèº«ã®ãƒ“ãƒ«ãƒ‰ã ã‘ã§ãªãã€ä¾å­˜ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã€‚Turborepoã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒ™å‹•ã§ã¯ä¾å­˜é–¢ä¿‚ã‚’è€ƒæ…®ã›ãšã«ä¸¦åˆ—ã«ãƒ“ãƒ«ãƒ‰ãŒè¡Œã‚ã‚Œã‚‹ãŸã‚ã€dependsOnã«ã‚ˆã‚‹åˆ¶å¾¡ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

- lint / test
ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯èƒ½ã ãŒæˆæžœç‰©ã‚’æ®‹ã•ãªã„ã®ã§ outputs ã¯ç©º

- dev
ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ãªã®ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–

ã“ã®æœ€å°æ§‹æˆã ã‘ã§ã‚‚ã€Œã©ã®ã‚¿ã‚¹ã‚¯ãŒã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‹ã€ã‚’æ˜Žç¤ºã§ãã€å…¨ä½“ã‚’è¦‹æ¸¡ã—ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚

## ä¸¦åˆ—å®Ÿè¡Œã¨ä¾å­˜è§£æ±º

Turborepo ã¯ã‚¿ã‚¹ã‚¯ã‚’ä¸¦åˆ—ã§å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ã€‚
ä¾‹ãˆã° turbo run build ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã—ãŸä¸Šã§ã€ç‹¬ç«‹ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã¯åŒæ™‚ã«èµ°ã‚Šã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã£ã¦ã€Œå¾…ã¡æ™‚é–“ãŒé•·ã„ãƒ“ãƒ«ãƒ‰ã€ã‚‚ä¸¦åˆ—åŒ–ã•ã‚Œã€å¾“æ¥ã®ç›´åˆ—å®Ÿè¡Œã‚ˆã‚Šæ™‚é–“çŸ­ç¸®ãŒæ”¹å–„ãŒè¦‹è¾¼ã‚ã¾ã™ã€‚å°ã•ãªæ”¹å–„ã«è¦‹ãˆã¦ã€æ—¥ã€…ã®é–‹ç™ºä½“é¨“ãŒå‘ä¸Šã—ã¾ã—ãŸã€‚

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ãƒªãƒ¢ãƒ¼ãƒˆï¼‰

Turborepo ã®æœ€å¤§ã®é­…åŠ›ã¯ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ ã§ã™ã€‚

### ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
ç›´å‰ã«å®Ÿè¡Œã—ãŸã‚¿ã‚¹ã‚¯ã®çµæžœã‚’ä¿å­˜ã—ã€åŒã˜å…¥åŠ›ãªã‚‰å†å®Ÿè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚
å‰å›žãƒ“ãƒ«ãƒ‰ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ãŒå¤‰ã‚ã£ã¦ã„ãªã‘ã‚Œã°ã€æ¬¡å›žã¯ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆã€ã§çž¬æ™‚ã«å®Œäº†ã—ã¾ã™ã€‚

### ãƒªãƒ¢ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥
ï¼ˆæœªå°Žå…¥ã§ã™ãŒï¼‰å°†æ¥çš„ã«ã¯ CI ã¨ã®é€£æºã§æ´»ç”¨äºˆå®šã§ã™ã€‚é–‹ç™ºè€…ã®ãƒ­ãƒ¼ã‚«ãƒ«ã¨ CI ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Œã°ã€CI ã®ãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒåŠ‡çš„ã«çŸ­ç¸®ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’å°Žå…¥ã—ãŸã ã‘ã§ã€ç‰¹ã«ãƒ“ãƒ«ãƒ‰ã®ç¹°ã‚Šè¿”ã—ã«ã‹ã‹ã‚‹æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œã¾ã—ãŸã€‚


## å®Ÿéš›ã®ã‚³ãƒžãƒ³ãƒ‰ä¾‹
-ã™ã¹ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ãƒ“ãƒ«ãƒ‰

```
pnpm run build:all
```
â†’ turbo.json ã®è¨­å®šã«å¾“ã£ã¦ã€ä¾å­˜è§£æ±ºï¼‹ä¸¦åˆ—å®Ÿè¡ŒãŒèµ°ã‚Šã¾ã™ã€‚

- ç‰¹å®šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã ã‘å®Ÿè¡Œ

```
pnpm --filter @frommiddle/web build
```

## æŒ¯ã‚Šè¿”ã‚Š
æœ€åˆã¯ã€Œã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ã£ã¦ãªãã¦ã‚‚ã„ã„ã®ã§ã¯ï¼Ÿã€ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚
ã—ã‹ã—ã€ãƒ¢ãƒŽãƒ¬ãƒã®ã‚ˆã†ã«è¤‡æ•°ã‚¢ãƒ—ãƒªãƒ»è¤‡æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç®¡ç†ã™ã‚‹ã¨ã€**ã€Œã©ã®ã‚¿ã‚¹ã‚¯ã‚’ã„ã¤å®Ÿè¡Œã™ã¹ãã‹ã€**ã‚’æ˜Žç¢ºã«å®šç¾©ã—ãªã„ã¨ã™ãã«ç ´ç¶»ã—ã¾ã™ã€‚

Turborepo ã‚’å…¥ã‚Œã¦ã¿ãŸçµæžœã€ä¾å­˜é–¢ä¿‚ã‚’æ„è­˜ã›ãšã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã‚‹å®‰å¿ƒæ„Ÿ

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹å¤§å¹…ãªæ™‚é–“çŸ­ç¸®ãƒ­ãƒ¼ã‚«ãƒ«ã¨ CI/CD ã®ä¸€è²«æ€§ã¨ã„ã£ãŸãƒ¡ãƒªãƒƒãƒˆã‚’ä½“æ„Ÿã§ãã¾ã—ãŸã€‚

ã€Œã¾ãšã¯ build ã¨ lint ã¨ test ã‚’å®šç¾©ã™ã‚‹ã€ç¨‹åº¦ã§ã‚‚ååˆ†ã«åŠ¹æžœãŒã‚ã‚‹ã®ã§ã€åˆå¿ƒè€…ãŒæœ€åˆå°Žå…¥ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã‚‚ãŠã™ã™ã‚ã§ãã¾ã™ã€‚

# ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆï¼ˆç¾çŠ¶ï¼‰

ãƒ¢ãƒŽãƒ¬ãƒã®ä¸­ã§æ‰±ã†ã‚¤ãƒ³ãƒ•ãƒ©ã¯ã€ã¾ã å¤§è¦æ¨¡ãªã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚  
ç¾æ™‚ç‚¹ã§ã¯ã€Œç’°å¢ƒã”ã¨ã« S3 ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã—ã€ã‚¢ãƒ—ãƒªã®æˆæžœç‰©ã‚’é…ç½®ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ã¨ã„ã†æœ€å°é™ã®ä»•çµ„ã¿ã«ã¨ã©ã¾ã£ã¦ã„ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã‚’å±•é–‹ã™ã‚‹éš›ã«CI/CDã‚’å‰æã¨ã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹åã‚’é©åˆ‡ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ä»•çµ„ã¿ã¥ãã‚Šã«ãƒˆãƒ©ã‚¤ã—ã¦ã¿ã¾ã—ãŸã€‚  

---


## åå‰ä»˜ã‘ã®æ–¹é‡
åå‰ä»˜ã‘ã®æ–¹é‡ã¨ã—ã¦ **é–‹ç™ºç’°å¢ƒï¼ˆdevï¼‰** ã¨ **æœ¬ç•ªç’°å¢ƒï¼ˆprodï¼‰** ã‚’åˆ†ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’é‡è¦è¦–ã—ã¾ã—ãŸã€‚ã¾ãŸAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚‰ã®åˆ‡ã‚Šæ›¿ãˆã‚’æ„è­˜ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã®ä¸­ã«ã¯AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚‚ä»˜ä¸Žã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚ã‚¹ãƒ†ãƒ¼ã‚¸åã‚’æ˜Žç¤ºçš„ã«ä»˜ä¸Žã™ã‚‹ã“ã¨ã§ã€ãƒªã‚½ãƒ¼ã‚¹ã®æ··åœ¨ã‚’é¿ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
å…·ä½“çš„ãªæ›¸å¼ã¨ã—ã¦ã¯ä»¥ä¸‹ã§ã™ã€‚
`{å›ºæœ‰prefix}-{stage}-{accountid}-{projectå}-{serviceå}-{ãƒªã‚½ãƒ¼ã‚¹ç¨®åˆ¥}`

ä¾‹:  
- `assets-dev-123456789012-myproj-web-bucket`  
- `assets-prod-210987654321-myproj-web-bucket`  

## å®Ÿè£…ä¸Šã®å·¥å¤«1ï¼šMeta æƒ…å ±ã‚’ã€Œpropsã€ã§å—ã‘æ¸¡ã™è¨­è¨ˆ

å®Ÿè£…ã§è€ƒæ…®ã—ãŸã®ã¯ã€**ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆdev/prodï¼‰ã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID**ã®ã‚ˆã†ãªã€Œæ¨ªæ–­çš„ãªãƒ¡ã‚¿æƒ…å ±ï¼ˆMetaï¼‰ã€ã‚’ã€  **ã©ã“ã§å®šç¾©ã—ã¦ã€ã©ã†ã‚„ã£ã¦å„ã‚¹ã‚¿ãƒƒã‚¯ï¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã«ä¼ãˆã‚‹ã‹**ã¨ã„ã†ç‚¹ã§ã—ãŸã€‚

æœ€åˆã¯ã‚¹ã‚¿ãƒƒã‚¯ã‚„ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã®å†…éƒ¨ã§ `process.env` ã‚„ `cdk.Context` ã‚’ç›´æŽ¥èª­ã‚€å®Ÿè£…ã«ã—ã¦ã„ã¾ã—ãŸãŒã€  ã ã‚“ã ã‚“ã€Œã©ã“ã§å€¤ãŒæ±ºã¾ã£ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šã¥ã‚‰ã„ã€ã€Œãƒ†ã‚¹ãƒˆã—ã¥ã‚‰ã„ã€ã¨ã„ã†å•é¡ŒãŒå‡ºã¦ãã¾ã—ãŸã€‚

ãã“ã§æ–¹é‡ã‚’æ”¹ã‚ã¦ã€**Meta ã‚’åž‹ã§è¡¨ç¾ã—ã€ã‚¹ã‚¿ãƒƒã‚¯ï¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã«ã¯ `props` çµŒç”±ã§æ˜Žç¤ºçš„ã«æ¸¡ã™**è¨­è¨ˆã«çµ±ä¸€ã—ã¾ã—ãŸã€‚

## å®Ÿè£…ä¸Šã®å·¥å¤«2:Meta æƒ…å ±ã®è§£æ±ºé †åºï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ > ç’°å¢ƒå¤‰æ•°ï¼‰

ã‚‚ã†ã²ã¨ã¤ã®å®Ÿè£…ä¸Šã®å·¥å¤«ã¨ã—ã¦ã€Meta æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã¨ãã« **ã€ŒCDK ã® contextã€ ã¨ ã€Œç’°å¢ƒå¤‰æ•°ã€** ã‚’ä¸¡æ–¹è€ƒæ…®ã—ã€  **context > ç’°å¢ƒå¤‰æ•°ã®é †ã§å„ªå…ˆã™ã‚‹**ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

### ãªãœã“ã®é †åºã‹ï¼Ÿ
- **context ã‚’æœ€å„ªå…ˆ**  
  - `cdk deploy --context stage=prod` ã®ã‚ˆã†ã«å®Ÿè¡Œæ™‚ã«æ˜Žç¤ºçš„ã«æŒ‡å®šã—ãŸå€¤ã‚’å°Šé‡ã™ã‚‹  
  - CI/CD ã‚„ãƒ­ãƒ¼ã‚«ãƒ«ã§æ„å›³çš„ã«ä¸Šæ›¸ãã—ãŸã„ã‚±ãƒ¼ã‚¹ã«æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹  
- **ç’°å¢ƒå¤‰æ•°ã‚’ fallback ã«**  
  - `process.env.STAGE=dev` ã®ã‚ˆã†ã«æ™®æ®µã®é–‹ç™ºç’°å¢ƒã§è‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹å€¤ã‚’ä½¿ã†  
  - context ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ˆã†ã«åŠ¹ã  

ã“ã‚Œã‚‰ã‚’è€ƒæ…®ã—ã¦ç°¡å˜ãªé–¢æ•°ã‚’ä½œæˆã—ã€å‘½åé–¢æ•°ã«æ¸¡ã™ã“ã¨ã§CDKå®Ÿè¡Œæ™‚ã®ç’°å¢ƒæƒ…å ±ã‚’çµ±ä¸€çš„ã«å…¥åŠ›ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ã“ã®é–¢æ•°ã¯ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã§ã®ã¿å‘¼ã³å‡ºã™æ–¹é‡ã¨ã—ã¦ã€å¾Œæ®µã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã«ã¯propsã§ãã®å€¤ã‚’ä¼ãˆã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¨­ã‘ã¾ã—ãŸã€‚

## ãƒªã‚½ãƒ¼ã‚¹å‘½åã®ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ

```ts
import type { Construct } from 'constructs';

export interface Meta {
  stage: string;
  project: string;
  service: string;
}

/** stage / project / service ã‚’ â‘ context â‘¡ç’°å¢ƒå¤‰æ•° â‘¢ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ ã®é †ã«å–å¾— */
export function getMeta(scope: Construct): Meta {
  const node = scope.node; // â† ã“ã“ã‚’ Stack.of(scope).node ã‹ã‚‰å¤‰æ›´

  const stage = (node.tryGetContext('stage') as string | undefined) ?? process.env.STAGE ?? 'dev';

  const project =
    (node.tryGetContext('project') as string | undefined) ?? process.env.PROJECT ?? 'myproject';

  const service =
    (node.tryGetContext('service') as string | undefined) ?? process.env.SERVICE ?? 'web';

  return { stage, project, service };
}

```

ä¸Šè¨˜ã®getMetaã§ç”Ÿæˆã—ãŸãƒ¡ã‚¿ãªæƒ…å ±ã‚’éƒ¨åˆ†çš„ã«å—ã‘å–ã‚‹å‰æã¨ã—ã¦ä½œã£ãŸåå‰ä½œæˆã®ã‚³ãƒ¼ãƒ‰ãŒä»¥ä¸‹ã§ã™ã€‚AWSã¯ãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã£ã¦åå‰ã®ä¸Šé™èª¿ãŒã‚ã‚‹ã®ã§ã€ãã†ã„ã£ãŸå€¤ã‚‚å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

```ts
import { Environment } from 'aws-cdk-lib';
import { Meta } from './meta-util';

export interface NameBuilderOptions {
  prefix?: string; // ä¾‹: bucketNamePrefix
  maxLen?: number; // ä¾‹: S3 ã¯ 63
  requireStartEndAlnum?: boolean; // å…ˆé ­æœ«å°¾ã‚’è‹±æ•°å­—ã«ã™ã‚‹ï¼ˆS3å‘ã‘ï¼‰
  includeAccount?: boolean; // account ã‚’å…¥ã‚Œã‚‹ã‹
  includeRegion?: boolean; // region ã‚’å…¥ã‚Œã‚‹ã‹
}

/**
 * ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨envæƒ…å ±ã‚’å—ã‘å–ã£ã¦ãƒªã‚½ãƒ¼ã‚¹åã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
 */
export function nameBuilder(
  meta: Meta,
  env: Environment,
  resourceType: string,
  opts: NameBuilderOptions = {},
): string {
  const {
    prefix,
    maxLen = 63,
    requireStartEndAlnum = true,
    includeAccount = true,
    includeRegion = false,
  } = opts;

  const { stage, project, service } = meta;

  // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æ§‹ç¯‰
  const segments = [
    prefix,
    stage,
    includeAccount ? env.account : undefined,
    project,
    service,
    resourceType,
    includeRegion ? env.region : undefined,
  ].filter((v): v is string => !!v && v.length > 0);

  // åå‰ã‚’ç”Ÿæˆ
  let name = segments
    .join('-')
    .toLowerCase()
    .replace(/[^a-z0-9-]/g, '-') // éžè¨±å¯æ–‡å­—â†’-
    .replace(/-{2,}/g, '-'); // é€£ç¶šãƒã‚¤ãƒ•ãƒ³ç•³ã‚€

  // å…ˆé ­æœ«å°¾ã®ãƒã‚¤ãƒ•ãƒ³ã‚’é™¤åŽ»ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
  if (requireStartEndAlnum) {
    name = name.replace(/^-+/, '').replace(/-+$/, '');
  }

  // æœ€å¤§é•·ã§åˆ‡ã‚Šè©°ã‚
  name = name.slice(0, maxLen);

  // å†åº¦å…ˆé ­æœ«å°¾ã®ãƒã‚¤ãƒ•ãƒ³ã‚’é™¤åŽ»ã—ã€ç©ºæ–‡å­—ã‚¬ãƒ¼ãƒ‰
  if (requireStartEndAlnum) {
    name = name.replace(/^-+/, '').replace(/-+$/, '');
    if (!name) name = 'x0'; // å…¨æ»…ã‚¬ãƒ¼ãƒ‰
  }

  return name;
}

```
## CDK ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ç‹¬ç«‹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®å·¥å¤«

ã‚¤ãƒ³ãƒ•ãƒ©éƒ¨åˆ†ã§å…±é€šçš„ã«ä½¿ã† **å‘½åé–¢æ•°ã‚„ Meta è§£æ±ºé–¢æ•°** ã¯ã€ã›ã£ã‹ããƒ¢ãƒŽãƒ¬ãƒã§ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€  
`packages/cdk-utils` ã®ã‚ˆã†ã« **ç‹¬ç«‹ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸** ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¾ã—ãŸã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã‚¹ã‚¿ãƒƒã‚¯ã‚„ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã€å†åˆ©ç”¨æ€§ã‚‚é«˜ã¾ã‚Šã¾ã™ã€‚

---

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãšã‚Œã®èª²é¡Œ

ãŸã ã—ã“ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å†…ã§ã¯ `aws-cdk-lib` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€  
ä»–ã®ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆä¾‹: `packages/infra`ï¼‰ã¨ **CDK ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãšã‚Œã‚‹å¯èƒ½æ€§** ãŒã‚ã‚Šã¾ã—ãŸã€‚  

ãƒ¢ãƒŽãƒ¬ãƒå†…ã§ CDK ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸æƒã„ã«ãªã‚‹ã¨ã€`cdk synth` ã‚„ `cdk deploy` ãŒä¸å®‰å®šã«ãªã£ãŸã‚Šã€åž‹å®šç¾©ãŒä¸€è‡´ã›ãšã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

---

### peerDependencies ã§æ•´åˆæ€§ã‚’æ‹…ä¿

ãã“ã§ `packages/cdk-utils/package.json` ã§ã¯ `aws-cdk-lib` ã¨ `constructs` ã‚’ **peerDependencies** ã¨ã—ã¦å®šç¾©ã—ã€  
åˆ©ç”¨å´ï¼ˆ`packages/infra`ï¼‰ã«ä¾å­˜é–¢ä¿‚ã‚’å§”ã­ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  

```json
// packages/cdk-utils/package.json
{
  "name": "@myscope/cdk-utils",
  "version": "1.0.0",
  "peerDependencies": {
    "aws-cdk-lib": "2.x",
    "constructs": "^10.4.0"
  }
}
```
ã“ã†ã™ã‚‹ã“ã¨ã§ã€ã‚¤ãƒ³ãƒ•ãƒ©å´ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè‡ªå‹•çš„ã«æƒã„ã€ãšã‚Œã‚’é˜²æ­¢ã§ãã¾ã™ã€‚

### pnpm overrides ã§ã®ä¸Šæ›¸ã

ã•ã‚‰ã«ãƒ«ãƒ¼ãƒˆã® package.json ã« pnpm ã® overrides ã‚’è¨­å®šã—ã€
ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã§åˆ©ç”¨ã™ã‚‹ CDK ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¼·åˆ¶çš„ã«æƒãˆã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
```json
// package.json (root)
{
  "pnpm": {
    "overrides": {
      "aws-cdk-lib": "2.206.0",
      "constructs": "^10.4.2"
    }
  }
}
```

ã“ã‚Œã«ã‚ˆã£ã¦ã€ä»®ã«ä¸‹ä½ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¾å­˜ã¨ã—ã¦è§£æ±ºã•ã‚ŒãŸã¨ã—ã¦ã‚‚ã€
ãƒ«ãƒ¼ãƒˆã§ä¸€å…ƒçš„ã«ä¸Šæ›¸ãã•ã‚Œã€å¸¸ã«çµ±ä¸€ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ CDK ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚


## æŒ¯ã‚Šè¿”ã‚Š

ã‚¤ãƒ³ãƒ•ãƒ©éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã€ã¾ã  S3 ãƒã‚±ãƒƒãƒˆã‚’ dev / prod ã«åˆ†ã‘ã¦æ§‹ç¯‰ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰ã®ã‚¹ã‚¿ãƒ¼ãƒˆã§ã—ãŸã€‚  æœ€åˆã¯å˜ç´”ã« `my-project-dev-bucket` / `my-project-prod-bucket` ã®ã‚ˆã†ãªåå‰ã‚’æ‰‹ã§æ›¸ãã ã‘ã§ã‚‚ååˆ†ã ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€CI/CDã®ã“ã¨ã‚’å¿µé ­ã«ãŠã„ãŸã‚Šã€ä¸€è²«æ€§ã®ã“ã¨ã‚’æƒ³åƒã™ã‚‹ã¨é–‹ç™ºã®ä½™åœ°ãŒç”Ÿã¾ã‚Œã¾ã—ãŸã€‚

ãã“ã§å–ã‚Šå…¥ã‚ŒãŸå·¥å¤«ãŒæ¬¡ã®ç‚¹ã§ã™ã€‚

- **å‘½åè¦å‰‡ã®å…±é€šåŒ–**  
  - CDK ã® context ã‚„ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã—ãŸæƒ…å ±ã‚’åŸºã«ã€`nameBuilder` ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§çµ±ä¸€çš„ã«ãƒªã‚½ãƒ¼ã‚¹åã‚’ç”Ÿæˆ  
  - AWS ãƒªã‚½ãƒ¼ã‚¹ã”ã¨ã®åˆ¶ç´„ï¼ˆ63æ–‡å­—åˆ¶é™ã‚„è‹±æ•°å­—ã§å§‹ã¾ã‚Šçµ‚ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãªã©ï¼‰ã‚‚è€ƒæ…®ã—ã€è‡ªå‹•çš„ã«èª¿æ•´ã§ãã‚‹ã‚ˆã†ã«ã—ãŸ  

- **Meta æƒ…å ±ã® props åŒ–**  
  - `stage`, `project`, `service` ã¨ã„ã£ãŸæ¨ªæ–­çš„ãªãƒ¡ã‚¿æƒ…å ±ã‚’ `Meta` åž‹ã¨ã—ã¦å®šç¾©  
  - ã‚¹ã‚¿ãƒƒã‚¯ã‚„ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã«ã¯ `props.meta` ã¨ã—ã¦æ˜Žç¤ºçš„ã«æ¸¡ã™æ–¹é‡ã«å¤‰æ›´  
  - ã“ã‚Œã«ã‚ˆã‚Šã€Œã©ã®å€¤ãŒã©ã“ã‹ã‚‰æ¥ã¦ã„ã‚‹ã‹ã€ãŒå¯è¦–åŒ–ã•ã‚Œã€ãƒ†ã‚¹ãƒˆã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã—ã‚„ã™ããªã£ãŸ  

- **context > ç’°å¢ƒå¤‰æ•° ã®å„ªå…ˆé †**  
  - `cdk deploy --context stage=prod` ã®ã‚ˆã†ã«æ˜Žç¤ºçš„ã«æŒ‡å®šã—ãŸå€¤ã‚’æœ€å„ªå…ˆ  
  - æŒ‡å®šãŒãªã‘ã‚Œã°ç’°å¢ƒå¤‰æ•°ã‚’ fallback ã¨ã—ã¦åˆ©ç”¨  
  - ã“ã‚Œã«ã‚ˆã‚Š CI/CD ã§ã¯ context ã‚’ä½¿ã£ã¦åˆ¶å¾¡ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ç’°å¢ƒå¤‰æ•°ã ã‘ã§è‡ªç„¶ã«å‹•ä½œã€ã¨ã„ã†æŸ”è»Ÿãªé‹ç”¨ãŒå¯èƒ½ã«ãªã£ãŸ  

- **CDK ç”¨ util ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ•´å‚™**  
  - å‘½åé–¢æ•°ã‚„ Meta è§£æ±ºé–¢æ•°ã‚’ `packages/cdk-utils` ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚
  - ã™ã¹ã¦ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚„ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰å…±é€šåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã€é‹ç”¨ãƒãƒªã‚·ãƒ¼å¤‰æ›´ã«ã‚‚å¼·ã„æ§‹æˆã«ã—ãŸ  

---

ã“ã†ã—ã¦è¦‹ã‚‹ã¨ã€æœ€åˆã¯ã€Œã¨ã‚Šã‚ãˆãšãƒã‚±ãƒƒãƒˆã‚’ä½œã‚‹ã€ç¨‹åº¦ã®å°ã•ãªä¸€æ­©ã§ã—ãŸãŒã€  
å‘½åãƒ«ãƒ¼ãƒ« â†’ Meta props åŒ– â†’ context/ç’°å¢ƒå¤‰æ•°ã®å„ªå…ˆé † â†’ util ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ– ã¨æ”¹å–„ã‚’ç©ã¿é‡ã­ãŸçµæžœã€  
**å°†æ¥ãƒªã‚½ãƒ¼ã‚¹ãŒå¢—ãˆã¦ã‚‚å®‰å¿ƒã—ã¦æ‹¡å¼µã§ãã‚‹åŸºç›¤**ãŒã§ãã¦ããŸã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚  

ã‚¤ãƒ³ãƒ•ãƒ©ã¯ã¾ã ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€ã“ã®è¨­è¨ˆã®ç©ã¿é‡ã­ãŒå¾Œã®æ‹¡å¼µï¼ˆRoute 53, API Gateway, Lambda, DynamoDB ãªã©ï¼‰ã«ã‚‚åŠ¹ã„ã¦ãã‚‹ã¯ãšã§ã™ã€‚

# CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

ãƒ¢ãƒŽãƒ¬ãƒã‚’é€²ã‚ã‚‹ä¸­ã§ã€Œå‹•ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’ã©ã†å®‰å…¨ã«ç’°å¢ƒã¸åæ˜ ã™ã‚‹ã‹ã€ã¨ã„ã†èª²é¡Œã«ç›´é¢ã—ã¾ã—ãŸã€‚  
ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã§ãã¦ã‚‚ã€ãã‚Œã‚’æœ¬ç•ªã«æ‰‹ä½œæ¥­ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã—ã¾ã†ã¨ãƒ’ãƒ¥ãƒ¼ãƒžãƒ³ã‚¨ãƒ©ãƒ¼ã®æ¸©åºŠã«ãªã‚Šã¾ã™ã€‚  
ãã“ã§ GitHub Actions ã‚’ä½¿ã£ã¦ã€**è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ã—ã€ç’°å¢ƒã«å¿œã˜ã¦å®‰å…¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**ã‚’çµ„ã¿ã¾ã—ãŸã€‚

ã¾ãŸã€AWS ã¨ã®æŽ¥ç¶šæ–¹æ³•ã«ã¤ã„ã¦ã¯ **OIDC (OpenID Connect)** ã‚’ãƒ™ãƒ¼ã‚¹ã«è¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚  
å¾“æ¥ã®ã‚ˆã†ã«é•·æœŸåˆ©ç”¨ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ Secrets ã«ç½®ã‹ãšã€GitHub Actions å®Ÿè¡Œæ™‚ã« OIDC ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œ â†’ AWS å´ã§ä¸€æ™‚çš„ã«ä¿¡é ¼é–¢ä¿‚ã‚’çµã¶ã“ã¨ã§ã€  
ã‚ˆã‚Šã‚»ã‚­ãƒ¥ã‚¢ã‹ã¤ã‚·ãƒ³ãƒ—ãƒ«ã«èªè¨¼ãƒ»èªå¯ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚  

## AWSã§ã®äº‹å‰æº–å‚™

GitHub Actions ã‹ã‚‰ AWS ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã¯ã€å¤§ããåˆ†ã‘ã¦ 2 ç¨®é¡žã‚ã‚Šã¾ã™ã€‚  
ã²ã¨ã¤ã¯ **æ°¸ç¶šã‚­ãƒ¼ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ï¼‰** ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã€ã‚‚ã†ã²ã¨ã¤ã¯ **OIDC (OpenID Connect)** ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

å¾“æ¥ã‚ˆãä½¿ã‚ã‚Œã¦ããŸã®ã¯ã€IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç™ºè¡Œã•ã‚ŒãŸ **ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’ Secrets ã«ä¿å­˜ã—ã€GitHub Actions å†…ã§ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å±•é–‹ã—ã¦åˆ©ç”¨ã™ã‚‹æ–¹å¼**ã§ã™ã€‚  
ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„ä¸€æ–¹ã§ã€æ¬¡ã®ã‚ˆã†ãªèª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

- é•·æœŸåˆ©ç”¨ã®ã‚­ãƒ¼ãŒãƒªãƒã‚¸ãƒˆãƒªã® Secrets ã«ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€æ¼æ´©ã—ãŸå ´åˆã®ãƒªã‚¹ã‚¯ãŒéžå¸¸ã«å¤§ãã„  
- ã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®šæœŸæ›´æ–°ï¼‰ã‚’æ‰‹å‹•ã§ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€é‹ç”¨ã‚³ã‚¹ãƒˆãŒé«˜ã„  
- Public ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ç‰¹ã«ã€å¤–éƒ¨ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³çµŒç”±ã§æ¼æ´©ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚‹  

ã“ã‚Œã«å¯¾ã—ã¦ã€ç¾åœ¨æŽ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ã®ãŒ **OIDC ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•**ã§ã™ã€‚  
GitHub Actions å®Ÿè¡Œæ™‚ã« GitHub ãŒ OIDC ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã€ãã‚Œã‚’ AWS å´ã§ä¿¡é ¼ã—ã¦ä¸€æ™‚çš„ãªèªè¨¼æƒ…å ±ã‚’æ‰•ã„å‡ºã™ä»•çµ„ã¿ã§ã™ã€‚ã“ã‚Œã«ã¯ã€æ¬¡ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

- **Secrets ã«ã‚­ãƒ¼ã‚’ä¿å­˜ã™ã‚‹å¿…è¦ãŒãªããªã‚‹** â†’ ä¸‡ãŒä¸€ãƒªãƒã‚¸ãƒˆãƒªãŒæµå‡ºã—ã¦ã‚‚é•·æœŸã‚­ãƒ¼ãŒæ¼ã‚Œãªã„  
- **ã‚­ãƒ¼ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸è¦** â†’ æ¯Žå›žä¸€æ™‚çš„ãªèªè¨¼æƒ…å ±ãŒæ‰•ã„å‡ºã•ã‚Œã‚‹ãŸã‚ã€ç®¡ç†ã‚³ã‚¹ãƒˆãŒå¤§å¹…ã«æ¸›ã‚‹  
- **IAM ãƒ­ãƒ¼ãƒ«ã¨ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹ç¯„å›²ã‚’æœ€å°åŒ–ã§ãã‚‹** â†’ ã©ã®ãƒªãƒã‚¸ãƒˆãƒªï¼ã©ã®ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ã®å®Ÿè¡Œã‚’è¨±å¯ã™ã‚‹ã‹ã‚’ç´°ã‹ãåˆ¶å¾¡å¯èƒ½  

ç¾åœ¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ã€æ°¸ç¶šã‚­ãƒ¼ã§ã¯ãªã **OIDC ã«ã‚ˆã‚‹èªè¨¼ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨**ã§ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨é‹ç”¨æ€§ã®ä¸¡ç«‹ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚


ã•ã¦ï½OIDC ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ **AWS å´ã§äº‹å‰è¨­å®šã‚’è¡Œã†å¿…è¦**ãŒã‚ã‚Šã¾ã™ã€‚  
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šé‡è¦ã«ãªã‚‹ã®ãŒã€IAM ãƒ­ãƒ¼ãƒ«ã«ãŠã‘ã‚‹ **GitHub Actions ã«å¯¾ã™ã‚‹ä¿¡é ¼é–¢ä¿‚ã®è¨­å®š**ã§ã™ã€‚  

IAM ãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã§ã¯ã€OIDC ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’ `arn:aws:iam::{accountid}:oidc-provider/token.actions.githubusercontent.com` ã¨ã—ã¦æŒ‡å®šã—ã€  
`sts:AssumeRoleWithWebIdentity` ã‚’è¨±å¯ã—ã¾ã™ã€‚  

ã•ã‚‰ã« Condition å¥ã§åˆ¶é™ã‚’ã‹ã‘ã‚‹ã“ã¨ã§ã€**ã€Œã©ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã€ã€Œã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ã€ç™ºè¡Œã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’å—ã‘å…¥ã‚Œã‚‹ã‹**ã‚’ç´°ã‹ãã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã¾ã™ã€‚  

ç‰¹ã« **StringLike å¥** ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è‚ã«ãªã‚Šã¾ã™ã€‚  
ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€  
- `repo:{username}/{reponame}:ref:refs/heads/dev` â†’ `dev` ãƒ–ãƒ©ãƒ³ãƒã®å®Ÿè¡Œã ã‘è¨±å¯  
- `repo:{username}/{reponame}:pull_request` â†’ PR å®Ÿè¡Œã ã‘è¨±å¯  

ã¨ã„ã†å½¢ã§ã€æƒ³å®šå¤–ã®ãƒ–ãƒ©ãƒ³ãƒã‚„ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³åˆ©ç”¨ã‚’é˜²ã’ã¾ã™ã€‚  

é–‹ç™ºã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã« AWS ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å ´åˆã¯ã€IAM ãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã«è¨˜è¿°ã™ã‚‹ Condition å¥ ã‚‚ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€dev ç’°å¢ƒã§ã‚ã‚Œã° refs/heads/devã€prod ç’°å¢ƒã§ã‚ã‚Œã° refs/heads/main ã®ã‚ˆã†ã«ã€ãƒ–ãƒ©ãƒ³ãƒåã¨ç’°å¢ƒã‚’å¯¾å¿œä»˜ã‘ã¦ StringLike å¥ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€å„ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ­£ã—ãåˆ¶å¾¡ã§ãã¾ã™ã€‚

ä¸‹è¨˜ã¯devã¨ã„ã†ãƒ–ãƒ©ãƒ³ãƒãŒé‹ç”¨ä¸Šå­˜åœ¨ã—ã¦ã„ã¦ã€ã¤ã„ã¨ãªã‚‹AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹å ´åˆã®ä¿¡é ¼é–¢ä¿‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::{accountid}:oidc-provider/token.actions.githubusercontent.com"
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "StringEquals": {
                    "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
                },
                "StringLike": {
                    "token.actions.githubusercontent.com:sub": [
                        "repo:{username}/{reponame}:ref:refs/heads/dev",
                        "repo:{username}/{reponame}:pull_request"
                    ]
                }
            }
        }
    ]
}
```

ä»Šå›ž IAM ãƒ­ãƒ¼ãƒ«ã«å¯¾ã—ã¦è¨­å®šã—ãŸãƒãƒªã‚·ãƒ¼ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ã«ãªã£ã¦ã„ã¾ã™ã€‚Assumeã™ã‚‹å…ˆã®ãƒªã‚½ãƒ¼ã‚¹cdk-hnb659fds-... ã¨ã„ã†åå‰ã¯ã€CDK ã®ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—æ™‚ã«è‡ªå‹•ã§ä½œæˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚å…·ä½“çš„ã«ã¯ CDK ãŒ cdk bootstrap ã‚’å®Ÿè¡Œã—ãŸéš›ã«ã€CloudFormation ã‚¹ã‚¿ãƒƒã‚¯ã‚’é€šã˜ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚ˆã†ã®IAM ãƒ­ãƒ¼ãƒ«ã‚’ç”Ÿæˆã—ã¦ãŠã‚Šã€ãã‚Œã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

``` json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "Statement1",
            "Effect": "Allow",
            "Action": [
                "sts:AssumeRole"
            ],
            "Resource": [
                "arn:aws:iam::{accountid}:role/cdk-hnb659fds-deploy-role-{accountid}-ap-northeast-1"
            ]
        }
    ]
}
```

---

## GitHubã«ãŠã‘ã‚‹ç’°å¢ƒå¤‰æ•°ã¨å€¤ã®è¨­å®š
ã‚„ã£ã¨GitHub Actionså´ã®è¨˜è¿°ã«æˆ»ã£ã¦ã“ã‚Œã¾ã—ãŸã€‚ã—ã‹ã—ã€GitHub Actionsã®ã‚³ãƒ¼ãƒ‰ã«æ˜ ã‚‹å‰ã«ã€ã¾ã è¨­å®šã®å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### GitHub ãƒªãƒã‚¸ãƒˆãƒªã«ãŠã‘ã‚‹ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ç®¡ç†

CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®‰å…¨ã«é‹ç”¨ã™ã‚‹ã†ãˆã§æ¬ ã‹ã›ãªã„ã®ãŒã€**ç’°å¢ƒå¤‰æ•°ï¼ˆVariablesï¼‰** ã¨ **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆSecretsï¼‰** ã®é©åˆ‡ãªç®¡ç†ã§ã™ã€‚  

- **ç’°å¢ƒå¤‰æ•° (Repository Variables)**  
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚„ã‚µãƒ¼ãƒ“ã‚¹åã€ã‚¹ãƒ†ãƒ¼ã‚¸åï¼ˆdev/prod ãªã©ï¼‰ã®ã‚ˆã†ã«ã€æ¯”è¼ƒçš„æ©Ÿå¾®ã§ã¯ãªã„è¨­å®šå€¤ã‚’ä¿å­˜ã™ã‚‹å ´æ‰€ã€‚  
  - `vars.PROJECT`, `vars.SERVICE`, `vars.AWS_REGION` ãªã©ã€ãƒªãƒã‚¸ãƒˆãƒªã® CI/CD å†…ã§å‚ç…§ã§ãã‚‹ã€‚  

- **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ (Repository Secrets)**  
  - AWS IAM ãƒ­ãƒ¼ãƒ« ARNã€API ãƒˆãƒ¼ã‚¯ãƒ³ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼ã‚­ãƒ¼ãªã©ã€å¤–éƒ¨ã«æ¼ã‚Œã¦ã¯ã„ã‘ãªã„æ©Ÿå¯†æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹å ´æ‰€ã€‚  
  - ä¾‹: `secrets.AWS_DEV_OIDC_ROLE_ARN`, `secrets.AWS_PROD_OIDC_ROLE_ARN`  
  - GitHub Actions ã®ãƒ­ã‚°ã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§å‚ç…§ã™ã‚‹ã¨ãã‚‚ **ãƒžã‚¹ã‚¯å‡¦ç†**ã•ã‚Œã¦è¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚  

---

### Public ãƒªãƒã‚¸ãƒˆãƒªã§ã®æ³¨æ„ç‚¹

GitHub Actions ã¯ **Public ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã€å®Ÿè¡Œãƒ­ã‚°ãŒèª°ã§ã‚‚é–²è¦§å¯èƒ½** ã¨ã„ã†ä»•æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ã¨ãã«Publicãƒªãƒã‚¸ãƒˆãƒªã§ã¯**Secrets ã‚„ Variables ãŒèª¤ã£ã¦å…¬é–‹ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹**ã“ã¨ã«ç´°å¿ƒã®æ³¨æ„ã‚’æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  

- **ãƒ­ã‚°å‡ºåŠ›ã«æ³¨æ„**  
  - `echo $AWS_DEV_OIDC_ROLE_ARN` ã®ã‚ˆã†ã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç›´æŽ¥ãƒ­ã‚°ã«å‡ºã™ã¨ã€ãƒžã‚¹ã‚¯ã•ã‚Œã‚‹ã¨ã¯ã„ãˆæ„å›³ã—ãªã„æ¼æ´©ãƒªã‚¹ã‚¯ã«ãªã‚‹ã€‚  
  - ãƒ‡ãƒãƒƒã‚°æ™‚ã§ã‚‚ç§˜å¯†æƒ…å ±ã‚’å‡ºåŠ›ã—ãªã„é‹ç”¨ãŒæœ›ã¾ã—ã„ã€‚  

- **ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®åˆ†é›¢**  
  - æ©Ÿå¾®ã§ãªã„æƒ…å ±ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åã‚„ç’°å¢ƒåï¼‰ã¯ Variables ã«ç½®ãã€Secrets å´ã«ã¯çµ¶å¯¾ã«ç½®ã‹ãªã„ã€‚  
  - é€†ã« Secrets å´ã«ã¯ **ã€Œæ¼ã‚Œã¦å›°ã‚‹ã‚‚ã®ã ã‘ã€** ã‚’é™å®šã—ã¦ä¿å­˜ã™ã‚‹ã€‚  

## å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆprereq ã‚¸ãƒ§ãƒ–ï¼‰
ã“ã“ã‹ã‚‰ãŒGithub Actionsã§å®šç¾©ã—ãŸå‡¦ç†ã®å†…å®¹èª¬æ˜Žã«ãªã‚Šã¾ã™ã€‚

ã¾ãšæœ€åˆã«èµ°ã‚‹ã®ãŒ **å‰ææ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯**ã§ã™ã€‚  
ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã«å¿…è¦ãªå¤‰æ•°ã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿã€ã‚’æœ€åˆã«æ¤œæŸ»ã—ã€è¶³ã‚Šãªã„ã‚‚ã®ãŒã‚ã‚Œã°å¾Œç¶šã®å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚

- å…±é€šã§å¿…è¦ãªã‚‚ã®: `AWS_REGION`, `PROJECT`, `SERVICE`
- dev ç”¨: `AWS_DEV_OIDC_ROLE_ARN`
- prod ç”¨: `AWS_PROD_OIDC_ROLE_ARN`

ä¸è¶³ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ `GITHUB_STEP_SUMMARY` ã«ä¸€è¦§ã§å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œç”»é¢ã‹ã‚‰ã™ãã«ç¢ºèªã§ãã¾ã™ã€‚  
ã“ã®ãŠã‹ã’ã§ã€Œè¨­å®šæ¼ã‚Œã«æ°—ã¥ã‹ãªã„ã¾ã¾ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã™ã‚‹ã€ã¨ã„ã£ãŸç„¡é§„ã‚’é˜²ã’ã¾ã™ã€‚

---

## ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¤å®šï¼ˆset-stage-variable ã‚¸ãƒ§ãƒ–ï¼‰

æ¬¡ã«ã€Œä»Šå›žã®å®Ÿè¡ŒãŒ dev / prod / preview ã®ã©ã‚Œãªã®ã‹ã€ã‚’åˆ¤å®šã—ã¦ã„ã¾ã™ã€‚  
GitHub ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ push ã¨ PR ãƒžãƒ¼ã‚¸ã§å‚ç…§ã§ãã‚‹å¤‰æ•°ãŒé•ã†ãŸã‚ã€**ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã«åˆ¤å®šæ–¹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å·¥å¤«**ã‚’ã—ã¦ã„ã¾ã™ã€‚

- PR ãƒžãƒ¼ã‚¸æ™‚ â†’ `base_ref`ï¼ˆãƒžãƒ¼ã‚¸å…ˆãƒ–ãƒ©ãƒ³ãƒï¼‰ã‚’åˆ©ç”¨
- push æ™‚ â†’ `ref` ã‚’åˆ©ç”¨

ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒžãƒ¼ã‚¸ã‚„ push ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§èª¤ã£ã¦ç’°å¢ƒã‚’åˆ¤å®šã—ã¦ã—ã¾ã†äº‹æ•…ã‚’é˜²ã„ã§ã„ã¾ã™ã€‚  
åˆ¤å®šçµæžœã¯ `stage` ã¨ã„ã†å‡ºåŠ›ã«ã¾ã¨ã‚ã‚‰ã‚Œã€å¾Œç¶šã‚¸ãƒ§ãƒ–ãŒå…±é€šã§åˆ©ç”¨ã§ãã¾ã™ã€‚

---

## ãƒ“ãƒ«ãƒ‰ï¼ˆbuild ã‚¸ãƒ§ãƒ–ï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤ã®å‰ã«ã¯å¿…ãšå…¨ä½“ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  
ã“ã“ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã¯ã‚·ãƒ³ãƒ—ãƒ«ã« **`pnpm run build:all`** ã§ã€Turborepo ãŒãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å…¨ä½“ã®ãƒ“ãƒ«ãƒ‰ã‚’èª¿æ•´ã—ã¦ãã‚Œã¾ã™ã€‚  

å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã”ã¨ã«å®šç¾©ã•ã‚ŒãŸ `build` ã‚¿ã‚¹ã‚¯ãŒã“ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’é€šã˜ã¦å‘¼ã°ã‚Œã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ãŠã‚Šã€  
ä¾‹ãˆã° `packages/infra` ã«ã‚ã‚‹ CDK ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ `build` ã‚¿ã‚¹ã‚¯ã« `cdk synth` ã‚’ç´ã¥ã‘ã¦ã„ã¾ã™ã€‚  

ã¤ã¾ã‚Šã€`build` ã‚¸ãƒ§ãƒ–ãã®ã‚‚ã®ã¯ã€Œå…¨ä½“ãƒ“ãƒ«ãƒ‰ã‚’ä¸€æ‹¬ã§èµ·å‹•ã™ã‚‹ã ã‘ã€ã§ã™ãŒã€  
å€‹ã€…ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå†…éƒ¨ã§ä½•ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‹ï¼ˆTypeScript ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚„ CDK synth ãªã©ï¼‰ã¯å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å´ã«è²¬å‹™ã‚’å§”ã­ã¦ã„ã¾ã™ã€‚  


---

## ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆdeploy-dev / deploy-prod ã‚¸ãƒ§ãƒ–ï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ PR ãŒãƒžãƒ¼ã‚¸ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ã‘å‹•ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚  
ã—ã‹ã‚‚ **å‰ææ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿å®Ÿè¡Œ**ã•ã‚Œã‚‹ã®ã§ã€è¨­å®šä¸è¶³ã®ã¾ã¾é–“é•ã£ã¦æœ¬ç•ªã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

- dev ç’°å¢ƒ
  - `dev` ãƒ–ãƒ©ãƒ³ãƒã«ãƒžãƒ¼ã‚¸ã•ã‚ŒãŸ PR ã®ã¿
  - `AWS_DEV_OIDC_ROLE_ARN` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿
- prod ç’°å¢ƒ
  - `main` ãƒ–ãƒ©ãƒ³ãƒã«ãƒžãƒ¼ã‚¸ã•ã‚ŒãŸ PR ã®ã¿
  - `AWS_PROD_OIDC_ROLE_ARN` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿

AWS ã¸ã®èªè¨¼ã«ã¯ **OIDC** ã‚’ä½¿ã£ã¦ãŠã‚Šã€é•·æœŸã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ Secrets ã«ç½®ã‹ãªãã¦ã‚‚ã‚ˆããªã‚Šã¾ã—ãŸã€‚  
CDK ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãã«ã¯ `--context stage/project/service` ã‚’æ¸¡ã—ã¦ãŠã‚Šã€ç’°å¢ƒã‚„ã‚µãƒ¼ãƒ“ã‚¹åã”ã¨ã«å‘½åè¦å‰‡ã‚’è‡ªå‹•ã§é©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

### å­¦ã³ã¨å·¥å¤«

å®Ÿéš›ã«å‹•ä½œã•ã›ã¦ã¿ã¦åˆ†ã‹ã£ãŸã®ã¯ã€**GitHub Actions ã§ã¯ã‚¸ãƒ§ãƒ–é–“ã§ä»®æƒ³ãƒžã‚·ãƒ³ã®çŠ¶æ…‹ãŒå¼•ãç¶™ãŒã‚Œãªã„**ã¨ã„ã†ç‚¹ã§ã™ã€‚ãã®ãŸã‚ã€ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã®æˆæžœç‰©ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¸ãƒ§ãƒ–ã§ãã®ã¾ã¾ä½¿ã†ã“ã¨ã¯ã§ããšã€  
**ãƒ‡ãƒ—ãƒ­ã‚¤ç›´å‰ã« `pnpm -w run build:all` ã‚’å†å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹**ã¨ã„ã†å­¦ã³ãŒã‚ã‚Šã¾ã—ãŸã€‚  

ã•ã‚‰ã«ã€CDK ã®ã‚¹ã‚¿ãƒƒã‚¯ã¯ `packages/infra` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€  
ä¾‹ãˆã°ãƒã‚±ãƒƒãƒˆåã‚’ç”Ÿæˆã™ã‚‹å‘½åé–¢æ•°ã®ã‚ˆã†ã« **åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«ä¾å­˜**ã™ã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚  
ã“ã®ä¾å­˜é–¢ä¿‚ã‚’æ­£ã—ãè§£æ±ºã™ã‚‹ãŸã‚ã«ã¯ã€**å˜ä¸€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã§ã¯ãªã `-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¦ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å…¨ä½“ã‚’ãƒ“ãƒ«ãƒ‰**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ï¼ˆbuildã‚¹ãƒ†ãƒƒãƒ—ã§ã¯rootã§ã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œã—ã¦ã„ãŸã®ã§`-w`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒãªãã€ã“ã®ä»•æ§˜ã«æ°—ãŒä»˜ãã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚ï¼‰  

çµæžœã¨ã—ã¦ã€  
- **æ¯Žå›žã‚¸ãƒ§ãƒ–ã”ã¨ã«ãƒ“ãƒ«ãƒ‰ã‚’ã‚„ã‚Šç›´ã™**ï¼ˆã‚¸ãƒ§ãƒ–é–“çŠ¶æ…‹ã¯å…±æœ‰ã•ã‚Œãªã„ï¼‰  
- **ä¾å­˜è§£æ±ºã®ãŸã‚ã«å…¨ä½“ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹**ï¼ˆ`pnpm -w run build:all`ï¼‰  

ã¨ã„ã†æ‰‹é †ãŒ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã¾ã‚Œã€å®‰å®šã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

## ã‚¿ã‚°ä»˜ã‘ï¼ˆtag-on-main ã‚¸ãƒ§ãƒ–ï¼‰

æœ€å¾Œã«ã€æœ¬ç•ª (`main`) ã«ãƒžãƒ¼ã‚¸ã•ã‚ŒãŸã¨ãã ã‘è‡ªå‹•ã§ Git ã‚¿ã‚°ã‚’æ‰“ã¤å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚  
ã‚¿ã‚°ã¯ SemVer ã®ãƒ‘ãƒƒãƒç•ªå·ã‚’è‡ªå‹•ã§ä¸Šã’ã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ã“ã‚Œã§ã€Œã©ã®ã‚³ãƒŸãƒƒãƒˆãŒã©ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ã€ã‚’è¿½ã„ã‚„ã™ããªã‚Šã¾ã™ã€‚  

æœ€åˆã¯ã‚¿ã‚°ã‚’æ‰‹å‹•ã§æ‰“ã£ã¦ã„ã¾ã—ãŸãŒã€å¿˜ã‚ŒãŸã‚Šä½œæ³•ãŒãƒãƒ©ãƒãƒ©ã«ãªã£ãŸã‚Šã—ã¦ã„ãŸã®ã§ã€è‡ªå‹•åŒ–ã—ã¦ã‹ã‚‰ã¯å±¥æ­´ãŒéƒ¨åˆ†çš„ã«ãã‚Œã„ã«ã§ããŸã¨æ€ã£ã¦ã„ã¾ã™ã€‚

---

## ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ

AWSå´ã®ãƒ­ãƒ¼ãƒ«ã‚„OIDCã®è¨­å®šã¯åˆ¥é€”å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãŠãŠã‚€ã­GitHub Actionsã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã§ã™ã€‚ã“ã®é–‹ç™ºã‚’ã—ã¦ã„ã‚‹æ™‚ã«ã€ä¸‹è¨˜ã‚’èª¿æ•´ã™ã‚‹ã®ãŒä¸€ç•ªæ¥½ã—ã‹ã£ãŸã§ã™ã€‚

```yaml
name: CI Workflow

on:
  push:
    branches:
      - 'feature/**'
  pull_request:
    types: [closed]
    branches: [main, dev]

jobs:
  prereq:
    runs-on: ubuntu-latest
    outputs:
      dev_configured: ${{ steps.check.outputs.dev_configured }}
      prod_configured: ${{ steps.check.outputs.prod_configured }}
      missing_dev: ${{ steps.check.outputs.missing_dev }}
      missing_prod: ${{ steps.check.outputs.missing_prod }}
    steps:
      - id: check
        run: |
          missing_common=()
          [[ -z "${{ vars.AWS_REGION }}" ]] && missing_common+=(AWS_REGION)
          [[ -z "${{ vars.PROJECT }}"   ]] && missing_common+=(PROJECT)
          [[ -z "${{ vars.SERVICE }}"   ]] && missing_common+=(SERVICE)

          missing_dev=("${missing_common[@]}")
          [[ -z "${{ secrets.AWS_DEV_OIDC_ROLE_ARN }}" ]] && missing_dev+=(AWS_DEV_OIDC_ROLE_ARN)
          if (( ${#missing_dev[@]} )); then
            echo "dev_configured=false" >> $GITHUB_OUTPUT
            printf "missing_dev=%s\n" "${missing_dev[*]}" >> $GITHUB_OUTPUT
          else
            echo "dev_configured=true" >> $GITHUB_OUTPUT
            echo "missing_dev=" >> $GITHUB_OUTPUT
          fi

          missing_prod=("${missing_common[@]}")
          [[ -z "${{ secrets.AWS_PROD_OIDC_ROLE_ARN }}" ]] && missing_prod+=(AWS_PROD_OIDC_ROLE_ARN)
          if (( ${#missing_prod[@]} )); then
            echo "prod_configured=false" >> $GITHUB_OUTPUT
            printf "missing_prod=%s\n" "${missing_prod[*]}" >> $GITHUB_OUTPUT
          else
            echo "prod_configured=true" >> $GITHUB_OUTPUT
            echo "missing_prod=" >> $GITHUB_OUTPUT
          fi

  set-stage-variable:
    needs: prereq
    if: >
      github.event_name == 'push' ||
      (github.event_name == 'pull_request' && github.event.pull_request.merged == true)
    runs-on: ubuntu-latest
    outputs:
      stage: ${{ steps.stage.outputs.stage }}
    steps:
      - uses: actions/checkout@v4
      - id: stage
        run: |
          if [[ "${{ github.event_name }}" == "pull_request" && "${{ github.pull_request.merged }}" == "true" ]]; then
            if [[ "${{ github.base_ref }}" == "main" ]]; then stage="prod"
            elif [[ "${{ github.base_ref }}" == "dev" ]]; then stage="dev"
            else stage="preview"; fi
          else
            if [[ "${{ github.ref }}" == "refs/heads/main" ]]; then stage="prod"
            elif [[ "${{ github.ref }}" == "refs/heads/dev" ]]; then stage="dev"
            else stage="preview"; fi
          fi
          echo "STAGE=$stage" >> $GITHUB_ENV
          echo "stage=$stage" >> $GITHUB_OUTPUT

  build:
    needs: set-stage-variable
    runs-on: ubuntu-latest
    env:
      STAGE: ${{ needs.set-stage-variable.outputs.stage }}
      PROJECT: ${{ vars.PROJECT }}
      SERVICE: ${{ vars.SERVICE }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '22' }
      - run: npm i -g pnpm
      - run: pnpm install
      - run: pnpm run build:all

  deploy-dev:
    needs: [prereq, set-stage-variable, build]
    if: >
      needs.set-stage-variable.outputs.stage == 'dev' &&
      github.event_name == 'pull_request' &&
      github.event.pull_request.merged == true &&
      needs.prereq.outputs.dev_configured == 'true'
    runs-on: ubuntu-latest
    permissions: { id-token: write, contents: read }
    env:
      AWS_REGION: ${{ vars.AWS_REGION }}
      STAGE: dev
      PROJECT: ${{ vars.PROJECT }}
      SERVICE: ${{ vars.SERVICE }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '22' }
      - run: npm i -g pnpm
      - run: pnpm install
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_DEV_OIDC_ROLE_ARN }} # arn:aws:iam::<ACCOUNT_ID>:role/<ROLE_NAME>
          aws-region: ${{ env.AWS_REGION }}
      - name: CDK deploy (dev)
        working-directory: packages/infra
        run: |
          pnpm install
          pnpm -w run build:all
          pnpm cdk deploy --require-approval never \
            --context stage=${{ env.STAGE }} \
            --context project=${{ env.PROJECT }} \
            --context service=${{ env.SERVICE }}

  deploy-prod:
    needs: [prereq, set-stage-variable, build]
    if: >
      needs.set-stage-variable.outputs.stage == 'prod' &&
      github.event_name == 'pull_request' &&
      github.event.pull_request.merged == true &&
      needs.prereq.outputs.prod_configured == 'true'
    runs-on: ubuntu-latest
    permissions: { id-token: write, contents: read }
    env:
      AWS_REGION: ${{ vars.AWS_REGION }}
      STAGE: prod
      PROJECT: ${{ vars.PROJECT }}
      SERVICE: ${{ vars.SERVICE }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '22' }
      - run: npm i -g pnpm
      - run: pnpm install
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_PROD_OIDC_ROLE_ARN }} # arn:aws:iam::<ACCOUNT_ID>:role/<ROLE_NAME>
          aws-region: ${{ env.AWS_REGION }}
      - name: CDK deploy (prod)
        working-directory: packages/infra
        run: |
          pnpm install
          pnpm -w run build:all
          pnpm cdk deploy --require-approval never \
            --context stage=${{ env.STAGE }} \
            --context project=${{ env.PROJECT }} \
            --context service=${{ env.SERVICE }}

  tag-on-main:
    needs: deploy-prod
    if: github.base_ref == 'main' && github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions: { contents: write }
    steps:
      - uses: actions/checkout@v4
      - id: get_tag
        run: |
          git fetch --tags
          latest=$(git tag --sort=-v:refname | head -n 1)
          echo "latest_tag=$latest" >> $GITHUB_OUTPUT
      - name: Create new tag
        run: |
          latest=${{ steps.get_tag.outputs.latest_tag }}
          if [[ -z "$latest" ]]; then new_tag="v0.1.0"
          else IFS='.' read -r M m p <<< "${latest#v}"; p=$((p+1)); new_tag="v$M.$m.$p"; fi
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git tag "$new_tag"
          git push origin "$new_tag"

```

### æŒ¯ã‚Šè¿”ã‚Š

ã“ã†ã—ã¦ CI/CD ã‚’æ•´ãˆã¦ã¿ã¦å®Ÿæ„Ÿã—ãŸã®ã¯ã€**ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ã‚’å…ˆã«ç½®ã„ã¦ãŠãå¤§åˆ‡ã•**ã§ã™ã€‚  

- å‰ææ¡ä»¶ãŒæƒã£ã¦ã„ãªã‘ã‚Œã°ãã‚‚ãã‚‚ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãªã„  
- ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¤å®šã‚’åŽ³å¯†ã«ã—ã¦èª¤ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é˜²ã  
- ãƒ“ãƒ«ãƒ‰ã‚’ä¸€åº¦ã«ã¾ã¨ã‚ã¦ä¸€è²«æ€§ã‚’æ‹…ä¿ã™ã‚‹  
- OIDC ã§èªè¨¼ã‚’å®‰å…¨ã«ã™ã‚‹  
- ã‚¿ã‚°ä»˜ã‘ã§å±¥æ­´ã‚’ãã¡ã‚“ã¨æ®‹ã™  

æœ€åˆã¯ã€ŒãŸã ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚Œã°ã„ã„ã€ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€ã“ã†ã—ã¦å·¥å¤«ã‚’ç©ã¿é‡ã­ã‚‹ã“ã¨ã§ã€å®‰å¿ƒã—ã¦é–‹ç™ºã§ãã‚‹åœŸå°ãŒã§ãã¦ãã¾ã—ãŸã€‚  
ä»Šå¾Œã¯ Turborepo ã®ãƒªãƒ¢ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ã€ã‚ˆã‚Šé«˜åº¦ãªãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã•ã‚‰ã«åŠ¹çŽ‡çš„ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã—ã¦ã„ãäºˆå®šã§ã™ã€‚


# ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

ãƒ¢ãƒŽãƒ¬ãƒã‚’é€²ã‚ã‚‹ã†ãˆã§ã€Œã‚³ãƒ¼ãƒ‰ã‚’ã©ã†ãã‚Œã„ã«ä¿ã¤ã‹ã€ã€Œç§˜å¯†æƒ…å ±ã‚’ã©ã†å®ˆã‚‹ã‹ã€ã¨ã„ã†èª²é¡Œã«ç›´é¢ã—ã¾ã—ãŸã€‚  
æœ€åˆã¯å‹•ã‘ã°ã‚ˆã„ã¨è€ƒãˆã¦ã„ã¾ã—ãŸãŒã€è¦æ¨¡ãŒå°‘ã—ãšã¤å¤§ãããªã‚‹ã«ã¤ã‚Œã¦ **ã€Œã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ¯Žå›žåŒã˜æŒ‡æ‘˜ãŒå‡ºã‚‹ã€ã€Œèª¤ã£ã¦ã‚­ãƒ¼ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãã†ã«ãªã‚‹ã€** ã¨ã„ã†ä¸å®‰ãŒå¼·ããªã£ã¦ãã¾ã—ãŸã€‚  

ãã“ã§ã€**ã‚³ãƒ¼ãƒ‰å“è³ªã‚’è‡ªå‹•ã§æ‹…ä¿ã™ã‚‹ä»•çµ„ã¿**ã¨**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹ä»•çµ„ã¿**ã‚’ãƒ¢ãƒŽãƒ¬ãƒã«çµ„ã¿è¾¼ã¿ã¾ã—ãŸã€‚

---

## Lint ã¨ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã®å°Žå…¥

ã¾ãšç€æ‰‹ã—ãŸã®ã¯ **Lint** ã¨ **ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ**ã§ã™ã€‚  
ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«ã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ã§è­°è«–ã™ã‚‹ã®ã¯æ™‚é–“ã®ç„¡é§„ã ã¨æ„Ÿã˜ã¦ã„ãŸã®ã§ã€è‡ªå‹•ã§æƒãˆã¦ã—ã¾ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚

- **ESLint**  
  - JavaScript/TypeScript ã®é™çš„è§£æžã‚’è¡Œã„ã€æ½œåœ¨çš„ãªãƒã‚°ã‚’é˜²æ­¢ã€‚  
  - TypeScript ã‚µãƒãƒ¼ãƒˆã‚’æœ‰åŠ¹ã«ã—ã¦åž‹å®‰å…¨æ€§ã‚’é«˜ã‚ã¾ã—ãŸã€‚  

- **Prettier**  
  - ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒžãƒƒã‚¿ã€‚ã‚»ãƒŸã‚³ãƒ­ãƒ³ã‚„ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãªã©ã‚’è‡ªå‹•æ•´å½¢ã€‚  
  - ã€Œèª°ãŒæ›¸ã„ã¦ã‚‚åŒã˜å½¢ã€ã«ãªã‚‹ã“ã¨ã§ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ä¸è¦ãªå·®åˆ†ãŒæ¿€æ¸›ã—ã¾ã—ãŸã€‚  

- **Markdownlint**  
  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ã‚ˆã†ã«å“è³ªã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«å°Žå…¥ã€‚  
  - è¨˜äº‹ã‚„ README ã‚’æ›¸ãã¨ãã®ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’çµ±ä¸€ã§ãã‚‹ã®ã§ã€å¾Œã‹ã‚‰èª­ã¿ã‚„ã™ã„çŠ¶æ…‹ã‚’ä¿ã¦ã¾ã™ã€‚  

çµæžœã¨ã—ã¦ã€**Lint ã¨ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã‚’ CI ã‚„ Git Hook ã«çµ„ã¿è¾¼ã‚€**ã“ã¨ã§ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ç‚¹ã§å•é¡Œã‚’è‡ªå‹•æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

## Git Hooks ã¨ Husky

è‡ªå‹•åŒ–ã®æµã‚Œã‚’ã•ã‚‰ã«å¼·åŒ–ã™ã‚‹ãŸã‚ã« **Husky** ã‚’å°Žå…¥ã—ã¾ã—ãŸã€‚  

- **pre-commit ãƒ•ãƒƒã‚¯**  
  - `eslint` / `prettier --check` / `markdownlint` ã‚’å®Ÿè¡Œ  
  - å•é¡ŒãŒã‚ã‚‹ã¨ã‚³ãƒŸãƒƒãƒˆè‡ªä½“ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ä»•çµ„ã¿  

- **pre-push ãƒ•ãƒƒã‚¯**  
  - `pnpm test` ã‚’å®Ÿè¡Œã—ã€æœ€ä½Žé™ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‰ãªã‘ã‚Œã°ãƒªãƒ¢ãƒ¼ãƒˆã« push ã§ããªã„ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  

æœ€åˆã¯ã€Œãƒ•ãƒƒã‚¯ã«æ™‚é–“ãŒã‹ã‹ã£ã¦é¢å€’ã‹ãªï¼Ÿã€ã¨æ€ã„ã¾ã—ãŸãŒã€æ…£ã‚Œã‚‹ã¨ **ã€Œå£Šã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒãƒªãƒã‚¸ãƒˆãƒªã«å…¥ã‚‰ãªã„å®‰å¿ƒæ„Ÿã€** ã®æ–¹ãŒå¤§ãããªã‚Šã¾ã—ãŸã€‚

---

## ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¤œå‡ºï¼ˆGitleaksï¼‰

ã‚‚ã†ä¸€ã¤é‡è¦ã ã£ãŸã®ãŒ **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®èª¤ã‚³ãƒŸãƒƒãƒˆé˜²æ­¢**ã§ã™ã€‚  
AWS ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚„ API ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã†ã£ã‹ã‚Šã‚³ãƒŸãƒƒãƒˆã—ã¦ã—ã¾ã†ã¨ã€å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªãªã‚‰å³ã‚¢ã‚¦ãƒˆã§ã™ã—ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã‚‚æ¼æ´©ãƒªã‚¹ã‚¯ã«ãªã‚Šã¾ã™ã€‚  

ãã“ã§å°Žå…¥ã—ãŸã®ãŒ **Gitleaks** ã§ã™ã€‚  

- **pre-commit ãƒ•ãƒƒã‚¯ã«çµ„ã¿è¾¼ã¿**  
  â†’ ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ã‚‚ã—ã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚Œã°å³ãƒ–ãƒ­ãƒƒã‚¯ã€‚  
- **CI ã§ã‚‚å®Ÿè¡Œ**  
  â†’ ä¸‡ãŒä¸€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ãƒƒã‚¯ã‚’ bypass ã—ã¦ã‚‚ã€PR æ™‚ã«æ¤œå‡ºã§ãã‚‹äºŒé‡ãƒã‚§ãƒƒã‚¯ä½“åˆ¶ã€‚  

æœ€åˆã«è¨­å®šã—ãŸã¨ãã¯ã€Œèª¤æ¤œçŸ¥ï¼ˆfalse positiveï¼‰ã€ã«æ‚©ã¾ã•ã‚Œã¾ã—ãŸãŒã€`.gitleaks.toml` ã‚’èª¿æ•´ã—ã¦ä¸è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é™¤å¤–ã™ã‚‹ã“ã¨ã§è½ã¡ç€ãã¾ã—ãŸã€‚  

---

## CI ã¨ã®çµ±åˆ

ã“ã‚Œã‚‰ã®ãƒã‚§ãƒƒã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ã§ã¯ãªãã€GitHub Actions ã® CI ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã‚‚çµ±åˆã—ã¾ã—ãŸã€‚  

- `lint:all` â†’ ESLint, Prettier, Markdownlint ã‚’ä¸€æ‹¬å®Ÿè¡Œ  
- `gitleaks` â†’ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¹ã‚­ãƒ£ãƒ³ã‚’ CI ä¸Šã§ã‚‚å®Ÿæ–½  

ã“ã†ã—ã¦ãŠãã“ã¨ã§ **ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã§é€ƒã—ã¦ã‚‚ CI ã§å¿…ãšæ­¢ã¾ã‚‹ã€** ä»•çµ„ã¿ã«ãªã‚Šã€å®‰å¿ƒã—ã¦é–‹ç™ºã‚’é€²ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

## æŒ¯ã‚Šè¿”ã‚Š

æœ€åˆã¯ **ã€Œã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ãªã‚“ã¦å¾Œã§ç›´ã›ã°ã„ã„ã€ã€Œç§˜å¯†æƒ…å ±ã¯æ°—ã‚’ã¤ã‘ã‚Œã°å¤§ä¸ˆå¤«ã€** ã¨è€ƒãˆã¦ã„ã¾ã—ãŸã€‚  
ã—ã‹ã—å®Ÿéš›ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé€²ã‚€ã¨ã€ã‚¹ã‚¿ã‚¤ãƒ«ã®ä¸çµ±ä¸€ã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¼æ´©ãƒªã‚¹ã‚¯ã¯å¤§ããªè² æ‹…ã«ãªã£ã¦ãã¾ã™ã€‚  

- Lint ã¨ãƒ•ã‚©ãƒ¼ãƒžãƒƒã‚¿ã§ã€Œäººé–“ãŒæŒ‡æ‘˜ã—ãªãã¦ã‚‚æ¸ˆã‚€ç’°å¢ƒã€ã‚’æ•´ãˆã‚‹  
- Husky ã§ã€Œå£Šã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚„æ¼æ´©ãƒªã‚¹ã‚¯ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«å…¥ã‚Œã•ã›ãªã„ã€  
- Gitleaks ã§ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æœ€å¾Œã®ç ¦ã‚’ç”¨æ„ã™ã‚‹ã€  

ã“ã†ã—ãŸä»•çµ„ã¿ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è‡ªå‹•ã§æ‹…ä¿ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  
çµæžœã¨ã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã€Œè¨­è¨ˆã‚„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æœ¬è³ªçš„ãªè­°è«–ã€ã«é›†ä¸­ã§ãã€é–‹ç™ºä½“é¨“ãŒæ ¼æ®µã«è‰¯ããªã£ãŸã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚


# é–‹ç™ºä½“é¨“ï¼ˆDXï¼‰è¨­è¨ˆ

ãƒ¢ãƒŽãƒ¬ãƒã‚’å§‹ã‚ã¦ã—ã°ã‚‰ãã™ã‚‹ã¨ã€ä»Šåº¦ã¯ **ã€Œã©ã†ã‚„ã£ãŸã‚‰ã‚‚ã£ã¨å¿«é©ã«é–‹ç™ºã§ãã‚‹ã‹ã€** ã¨ã„ã†èª²é¡ŒãŒå‡ºã¦ãã¾ã—ãŸã€‚  
ã›ã£ã‹ã CI/CD ã‚„å“è³ªãƒã‚§ãƒƒã‚¯ã‚’æ•´ãˆã¦ã‚‚ã€æ—¥ã€…ã®é–‹ç™ºãŒã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒ«ã ã¨ç¶šãã¾ã›ã‚“ã€‚  
ãã“ã§æ„è­˜ã—ãŸã®ãŒ **DX (Developer Experience)** â€• é–‹ç™ºè€…ä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹ä»•çµ„ã¿ã¥ãã‚Šã§ã™ã€‚

---

## DevContainer ã«ã‚ˆã‚‹ç’°å¢ƒçµ±ä¸€

æœ€åˆã«å–ã‚Šçµ„ã‚“ã ã®ã¯ **ç’°å¢ƒã®çµ±ä¸€**ã§ã—ãŸã€‚  
ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ç›´æŽ¥ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€OS ã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é•ã„ã§å‹•ä½œãŒå¤‰ã‚ã‚‹å•é¡ŒãŒèµ·ãã‚„ã™ããªã‚Šã¾ã™ã€‚  

- **DevContainer** ã‚’å°Žå…¥ã—ã€Node.js / AWS CLI / pnpm / CDK ãªã©ã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚  
- VS Code ã® Remote Container æ©Ÿèƒ½ã‚’ä½¿ãˆã°ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã„ãŸçž¬é–“ã«åŒã˜ç’°å¢ƒã§ä½œæ¥­é–‹å§‹ã§ãã¾ã™ã€‚  
- CI ç’°å¢ƒã§ã‚‚ã»ã¼åŒã˜ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã§ãã‚‹ãŸã‚ã€**ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯å‹•ã„ãŸã®ã« CI ã§è½ã¡ã‚‹ã€**å•é¡Œã‚’å¤§å¹…ã«æ¸›ã‚‰ã›ã¾ã—ãŸã€‚  

ã“ã‚Œã«ã‚ˆã£ã¦ã€Œç’°å¢ƒæ§‹ç¯‰ã®ã¤ã¾ãšãã€ãŒãªããªã‚Šã€èª°ã§ã‚‚ã™ãã«é–‹ç™ºã«å‚åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

---

## ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã¨ CI ã®ä¸€è²«æ€§

DX ã‚’è€ƒãˆã‚‹ä¸Šã§æ„è­˜ã—ãŸã®ã¯ **ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã¨ CI ã®ä½“é¨“ã‚’æƒãˆã‚‹ã€**ã“ã¨ã§ã™ã€‚  

- ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¯ã™ã¹ã¦ **pnpm scripts** ã«å¯„ã›ã‚‹  
- CI ã§ã‚‚ `pnpm run lint:all`, `pnpm run test`, `pnpm run build:all` ã‚’ãã®ã¾ã¾åˆ©ç”¨  
- Turborepo ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã‚’ä½¿ã£ã¦ã€ä¾å­˜é–¢ä¿‚ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚çµ±ä¸€  

ã“ã†ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºè€…ãŒãƒ­ãƒ¼ã‚«ãƒ«ã§å©ãã‚³ãƒžãƒ³ãƒ‰ã¨ã€CI ãŒå®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ãŒä¸€è‡´ã—ã€**ã€ŒCI å°‚ç”¨ã®ã‚ˆãã‚ã‹ã‚‰ãªã„ã‚³ãƒžãƒ³ãƒ‰ã€**ã‚’è¦šãˆã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã—ãŸã€‚

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ï¼ˆJest / Vitest / React Testing Libraryï¼‰

ãƒ†ã‚¹ãƒˆã¯æœ€åˆã»ã¨ã‚“ã©æ›¸ã‘ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚  
ã—ã‹ã—è¦æ¨¡ãŒå¤§ãããªã‚‹ã¨ã€Œå®‰å¿ƒã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§ããªã„ã€çŠ¶æ…‹ãŒè¾›ããªã‚Šã€å¾ã€…ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãè¶³ã—ã¦ã„ãã¾ã—ãŸã€‚

- **Jest**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã«åˆ©ç”¨  
- **Vitest**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è»½é‡ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã«åˆ©ç”¨  
- **React Testing Library**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç¢ºèªã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ç›®ç·šã§è¨˜è¿°  

ã“ã‚Œã‚‰ã‚’ãƒ¢ãƒŽãƒ¬ãƒå…¨ä½“ã«çµ„ã¿è¾¼ã¿ã€`pnpm test` ã§ã¾ã¨ã‚ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  
ç‰¹ã« React Testing Library ã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã†ç”»é¢ã‚’æ“ä½œã™ã‚‹ã‹ã€ã«è¿‘ã„è¦–ç‚¹ã§æ›¸ã‘ã‚‹ã®ã§ã€ãƒã‚°ã®å†ç¾ã‚„å›žé¿ã«å½¹ç«‹ã£ã¦ã„ã¾ã™ã€‚

---

## ãƒ‡ãƒãƒƒã‚°ã¨ç›£è¦–ã®å·¥å¤«

é–‹ç™ºä¸­ã«ã€Œå•é¡ŒãŒèµ·ããŸã¨ãã«ç´ æ—©ãæ°—ã¥ã‘ã‚‹ã€ä»•çµ„ã¿ã‚‚ DX ã«ã¯æ¬ ã‹ã›ã¾ã›ã‚“ã€‚  

- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ `pnpm dev` ã§ãƒ•ãƒ­ãƒ³ãƒˆã¨ API ã‚’ä¸¦åˆ—èµ·å‹•ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ã¾ã¨ã‚ã¦ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  
- Turborepo ã®ãƒ­ã‚°ã‚’æ´»ç”¨ã—ã¦ã€ã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å¤±æ•—ã—ãŸã®ã‹ä¸€ç›®ã§ã‚ã‹ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  
- CI ã§ã¯å¤±æ•—ã—ãŸã‚¹ãƒ†ãƒƒãƒ—ã‚’ GitHub Actions ã® UI ã§ç¢ºèªã§ãã‚‹ã®ã§ã€å•é¡Œã®åˆ‡ã‚Šåˆ†ã‘ãŒå®¹æ˜“ã«ãªã‚Šã¾ã—ãŸã€‚  

ã¾ã æœ¬æ ¼çš„ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¾ã§ã¯ã§ãã¦ã„ã¾ã›ã‚“ãŒã€**ã€Œå¤±æ•—ã«æ—©ãæ°—ã¥ã‘ã‚‹ä»•çµ„ã¿ã€**ã‚’æŒã¤ã ã‘ã§å¿ƒç†çš„ãªå®‰å¿ƒæ„ŸãŒé•ã„ã¾ã™ã€‚

---

## æŒ¯ã‚Šè¿”ã‚Š

æœ€åˆã¯ **ã€Œã¨ã‚Šã‚ãˆãšã‚³ãƒ¼ãƒ‰ãŒå‹•ã‘ã°ã‚ˆã„ã€** ã¨ã„ã†çŠ¶æ…‹ã‹ã‚‰å§‹ã¾ã‚Šã¾ã—ãŸãŒã€DX ã‚’æ•´å‚™ã—ã¦ã„ãã†ã¡ã«æ¬¡ã®ã‚ˆã†ãªåŠ¹æžœãŒå‡ºã¾ã—ãŸã€‚  

- **DevContainer** ã§ç’°å¢ƒå·®ç•°ã‚’ãªãã—ã€æ–°è¦å‚åŠ è€…ã‚‚ã™ãé–‹ç™ºã§ãã‚‹  
- **ãƒ­ãƒ¼ã‚«ãƒ«ã¨ CI ã®ä¸€è²«æ€§**ã§ã€è¦šãˆã‚‹ã¹ãã‚³ãƒžãƒ³ãƒ‰ãŒæ¸›ã‚Šã€ãƒˆãƒ©ãƒ–ãƒ«ã‚‚å°‘ãªããªã£ãŸ  
- **ãƒ†ã‚¹ãƒˆå°Žå…¥**ã«ã‚ˆã‚Šå®‰å¿ƒã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ  
- **ãƒ‡ãƒãƒƒã‚°ãƒ»ç›£è¦–ã®å·¥å¤«**ã§å¤±æ•—ã«ã™ãæ°—ã¥ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸ  

DX ã‚’æ„è­˜ã™ã‚‹ã“ã¨ã§ã€Œé–‹ç™ºè€…ã¨ã—ã¦æ°—æŒã¡ã‚ˆãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã‚‹ç’°å¢ƒã€ãŒæ•´ã„ã€ãƒ¢ãƒŽãƒ¬ãƒã‚’ç¶™ç¶šçš„ã«é‹ç”¨ã™ã‚‹åœŸå°ãŒå¼·ããªã£ãŸã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚


# ã¾ã¨ã‚ã¨ä»Šå¾Œã®å±•æœ›

## ç¾çŠ¶ã®åˆ°é”ç‚¹
ã“ã®ãƒ¢ãƒŽãƒ¬ãƒç’°å¢ƒã¯ã€æœ€åˆã¯ã€Œè¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚’ã²ã¨ã¤ã«ã¾ã¨ã‚ãŸã„ã€ã¨ã„ã†å°ã•ãªå‹•æ©Ÿã‹ã‚‰å§‹ã¾ã‚Šã¾ã—ãŸã€‚  
è©¦è¡ŒéŒ¯èª¤ã‚’ç¹°ã‚Šè¿”ã™ä¸­ã§ã€å°‘ã—ãšã¤æ¬¡ã®ã‚ˆã†ãªä»•çµ„ã¿ã‚’æ•´ãˆã¦ãã¾ã—ãŸã€‚

- **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†**  
  â†’ `apps/` ã¨ `packages/` ã«åˆ†ã‘ã¦æ•´ç†ã€pnpm workspace ã§ä¾å­˜é–¢ä¿‚ã‚’ä¸€å…ƒç®¡ç†  

- **ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥**  
  â†’ Turborepo ã«ã‚ˆã‚Šãƒ“ãƒ«ãƒ‰ã‚„ãƒ†ã‚¹ãƒˆã‚’åŠ¹çŽ‡åŒ–ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§é–‹ç™ºä½“é¨“ã‚’æ”¹å–„  

- **ã‚¤ãƒ³ãƒ•ãƒ©è¨­è¨ˆï¼ˆç¾çŠ¶ï¼‰**  
  â†’ dev/prod ç”¨ã« S3 ãƒã‚±ãƒƒãƒˆã‚’åˆ†é›¢ã—ã€å®‰å…¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹åŸºç›¤ã‚’æ•´å‚™  

- **CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**  
  â†’ GitHub Actions ã§å‰æãƒã‚§ãƒƒã‚¯ â†’ ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¤å®š â†’ ãƒ“ãƒ«ãƒ‰ â†’ ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ ã‚¿ã‚°ä»˜ã‘ã®æµã‚Œã‚’è‡ªå‹•åŒ–  

- **ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**  
  â†’ ESLint / Prettier / Markdownlint / Husky / Gitleaks ã‚’çµ„ã¿è¾¼ã¿ã€å®‰å¿ƒã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒŸãƒƒãƒˆã§ãã‚‹ç’°å¢ƒã‚’å®Ÿç¾  

- **é–‹ç™ºä½“é¨“ï¼ˆDXï¼‰**  
  â†’ DevContainer ã«ã‚ˆã‚‹ç’°å¢ƒçµ±ä¸€ã€ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®å°Žå…¥ã€ãƒ­ãƒ¼ã‚«ãƒ«ã¨ CI ã®ä¸€è²«æ€§ã‚’æ„è­˜ã—ãŸé–‹ç™ºåŸºç›¤ã‚’æ§‹ç¯‰  

ã€Œæœ€åˆã¯é›£ã—ãã†ã€ã¨æ€ã£ã¦ã„ãŸãƒ¢ãƒŽãƒ¬ãƒã§ã™ãŒã€å°‘ã—ãšã¤æ©Ÿèƒ½ã‚’ç©ã¿ä¸Šã’ã‚‹ã“ã¨ã§ã€ä»Šã§ã¯ **å®‰å¿ƒã—ã¦é–‹ç™ºã§ãã‚‹ç’°å¢ƒ** ãŒæ‰‹ã«å…¥ã£ãŸã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

---

## ä»Šå¾Œè¿½åŠ ã‚’æ¤œè¨Žã—ã¦ã„ã‚‹æ©Ÿèƒ½
ç¾çŠ¶ã¯ã¾ã  â€œæœ€å°é™ã®åŸºç›¤â€ ã§ã™ã€‚ã“ã‚Œã‹ã‚‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ‹¡å¼µã‚’æ¤œè¨Žã—ã¦ã„ã¾ã™ã€‚

- **ã‚¤ãƒ³ãƒ•ãƒ©ã®æœ¬æ ¼çš„ãª IaC åŒ–**  
  - AWS CDK ã§ S3 ä»¥å¤–ã®ãƒªã‚½ãƒ¼ã‚¹ï¼ˆAPI Gateway, Lambda, Route 53, DynamoDB ãªã©ï¼‰ã‚’çµ±åˆçš„ã«ç®¡ç†  
  - ã‚¹ãƒ†ãƒ¼ã‚¸åä»˜ä¸Žãƒãƒªã‚·ãƒ¼ã‚’å¾¹åº•ã—ã€ãƒªã‚½ãƒ¼ã‚¹è¡çªã‚’é˜²æ­¢  

- **ãƒªãƒ¢ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å°Žå…¥**  
  - Turborepo ã®ãƒªãƒ¢ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨ã—ã€CI/CD ã®ãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’ã•ã‚‰ã«çŸ­ç¸®  

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®é«˜åº¦åŒ–**  
  - Gitleaks ã«åŠ ãˆã¦ Trivy ã‚„ Dependabot ã‚’å°Žå…¥ã—ã€ä¾å­˜é–¢ä¿‚ã‚„ã‚³ãƒ³ãƒ†ãƒŠã®è„†å¼±æ€§ã«ã‚‚å¯¾å¿œ  

- **è‡ªå‹•ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼**  
  - Git ã‚¿ã‚°ä»˜ã‘ã‚’èµ·ç‚¹ã«ã€è‡ªå‹•ã§ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ã‚’è¿½åŠ   
  - ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã¨å¤‰æ›´å±¥æ­´ã‚’ã‚ˆã‚Šæ˜Žç¢ºã«ç®¡ç†  

- **é–‹ç™ºè€…å‘ã‘ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå……å®Ÿ**  
  - æ–°ã—ãå‚åŠ ã—ãŸäººãŒè¿·ã‚ãªã„ã‚ˆã†ã€README ã‚„è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ•´å‚™  

---

## æ”¹å–„ã‚µã‚¤ã‚¯ãƒ«ã®å›žã—æ–¹
ãƒ¢ãƒŽãƒ¬ãƒã®è‰¯ã„ã¨ã“ã‚ã¯ã€Œå°ã•ãªæ”¹å–„ã‚’ã™ãå…¨ä½“ã«åæ˜ ã§ãã‚‹ã€ç‚¹ã§ã™ã€‚  
ãŸã¨ãˆã°ã€å‘½åãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…±é€šåŒ–ã—ãŸã‚ˆã†ã«ã€å°ã•ãªå·¥å¤«ãŒå¾Œã‹ã‚‰åŠ¹ã„ã¦ãã¾ã™ã€‚  

ä»Šå¾Œã‚‚ **ã€Œå°ã•ãè©¦ã™ â†’ å…±é€šåŒ–ã™ã‚‹ â†’ è‡ªå‹•åŒ–ã™ã‚‹ã€** ã¨ã„ã†ã‚µã‚¤ã‚¯ãƒ«ã‚’å›žã—ãªãŒã‚‰ã€  
å°‘ã—ãšã¤é–‹ç™ºä½“é¨“ã¨é‹ç”¨åŸºç›¤ã‚’ç£¨ãä¸Šã’ã¦ã„ãäºˆå®šã§ã™ã€‚

---

## æœ€å¾Œã«
ã“ã®ãƒ¢ãƒŽãƒ¬ãƒã¯ã¾ã ç™ºå±•é€”ä¸Šã§ã™ãŒã€åˆå¿ƒè€…ãŒä¸€æ­©ãšã¤çµ„ã¿ä¸Šã’ã¦ã„ã£ãŸè¨˜éŒ²ãã®ã‚‚ã®ã§ã™ã€‚  
åŒã˜ã‚ˆã†ã«ã€Œãƒ¢ãƒŽãƒ¬ãƒã‚’å§‹ã‚ã¦ã¿ãŸã„ã‘ã‚Œã©é›£ã—ãã†ã€ã¨æ„Ÿã˜ã¦ã„ã‚‹æ–¹ã«ã€ã“ã®è¨˜äº‹ãŒå°‘ã—ã§ã‚‚å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚  
ãã—ã¦ã“ã‚Œã‹ã‚‰ã‚‚ã€ã‚ˆã‚Šå®Ÿè·µçš„ã§å¿«é©ãªãƒ¢ãƒŽãƒ¬ãƒé‹ç”¨ã‚’ç›®æŒ‡ã—ã¦æ”¹å–„ã‚’ç¶šã‘ã¦ã„ãã¾ã™ã€‚

